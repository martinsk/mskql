<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mskql &mdash; mskql vs PostgreSQL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .caveat {
            border: 1.5px solid var(--accent);
            border-radius: 6px;
            padding: 1rem 1.2rem;
            margin: 1.6rem 0;
            background: #fff;
        }
        .caveat strong { color: var(--accent); }

        .faster { color: #1a7a1a; font-weight: 600; }
        .slower { color: var(--accent); font-weight: 600; }

        td.num, th.num { white-space: nowrap; text-align: right; }
        .bar-cell { padding: 0.4rem 0.4rem 0.4rem 0.8rem; }
        .bar-wrap {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .bar {
            height: 14px;
            border-radius: 2px;
            min-width: 2px;
        }
        .bar-mskql { background: var(--accent); }
        .bar-pg { background: #4a7ab5; }

        .legend {
            display: flex;
            gap: 1.5rem;
            font-size: 0.95rem;
            color: var(--fg-dim);
            margin-bottom: 0.8rem;
        }
        .legend-swatch {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 2px;
            vertical-align: middle;
            margin-right: 0.3rem;
        }

        .group-label td {
            padding-top: 1rem;
            font-variant: small-caps;
            letter-spacing: 0.04em;
            font-size: 0.85rem;
            color: var(--fg-dim);
            border-bottom: 1px solid var(--rule);
        }

        .tp-higher { color: #1a7a1a; font-weight: 600; }
        .tp-lower { color: var(--accent); font-weight: 600; }
    </style>
</head>
<body>

<p class="breadcrumb"><a href="index.html">&larr; mskql</a></p>

<h1>mskql vs PostgreSQL</h1>
<span class="subtitle">Two benchmarks, one honest picture</span>
<p class="byline">
    <a href="index.html">&#8592; back to main page</a>
</p>
<hr class="title-rule">

<p>
    <strong>mskql is faster than PostgreSQL in all 19 batch workloads.
    Aggregates run 9&times; faster. Inserts 3&times;.</strong>
    Under concurrent load, mskql wins 5 of 7 workloads&mdash;aggregate
    throughput is 9.4&times; higher. PostgreSQL wins on full table scans
    and filtered scans where the network dominates.
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  WHAT: Setup and framing                                    -->
<!-- ═══════════════════════════════════════════════════════════ -->

<div class="caveat">
    <strong>&#9888; Important caveat.</strong>&ensp;This comparison is <em>unscientific</em>
    and intended only as a directional indicator. mskql is an in-memory toy database with
    no durability, no MVCC, no WAL, no background workers, and no query optimizer.
    PostgreSQL is a production-grade RDBMS with decades of engineering behind it.
    The numbers below measure wall-clock time for identical SQL workloads over a loopback
    TCP connection&mdash;not raw engine speed. Take them as a rough sense of where mskql
    sits, not as a serious benchmark.
</div>

<h2>1. Methodology</h2>

<h3>Batch latency</h3>
<p>
    Both databases are tested on the same Apple&nbsp;M-series laptop, same loopback interface,
    using the same <code>psql</code> client. The benchmark script
    (<code>bench/bench_vs_pg.py</code>) generates identical SQL workloads for each test,
    runs setup against both databases, then times the benchmark queries. Each timing measures
    a single <code>psql&nbsp;-f</code> invocation containing all iterations of that workload.
    mskql runs on port&nbsp;5433; PostgreSQL on port&nbsp;5432 with default configuration.
</p>

<h3>Concurrent throughput</h3>
<p>
    A multi-threaded C benchmark (<code>bench/bench_throughput.c</code>) opens 4 persistent
    <code>libpq</code> connections and fires queries for 5&nbsp;seconds per workload.
    Measures QPS and median latency (p50).
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  SO WHAT: The data                                          -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>2. Batch Latency (single client, sequential)</h2>

<p>
    Ratio &lt;&nbsp;1.0 means mskql was faster; &gt;&nbsp;1.0 means PostgreSQL was faster.
    Results vary between runs&mdash;treat these as order-of-magnitude indicators.
</p>

<div class="legend">
    <span><span class="legend-swatch" style="background:var(--accent)"></span>mskql</span>
    <span><span class="legend-swatch" style="background:#4a7ab5"></span>PostgreSQL</span>
</div>

<table style="table-layout:fixed">
    <colgroup>
        <col style="width:22%">
        <col style="width:14%">
        <col style="width:14%">
        <col style="width:10%">
        <col style="width:40%">
    </colgroup>
    <thead>
        <tr>
            <th>Workload</th>
            <th class="num" style="text-align:right">mskql&ensp;(ms)</th>
            <th class="num" style="text-align:right">pg&ensp;(ms)</th>
            <th class="num" style="text-align:right">Ratio</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr class="group-label"><td colspan="5">reads</td></tr>
        <tr>
            <td><strong>select_full_scan</strong></td>
            <td class="num">294</td>
            <td class="num">451</td>
            <td class="num"><span class="faster">0.65&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:65%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>select_where</strong></td>
            <td class="num">352</td>
            <td class="num">610</td>
            <td class="num"><span class="faster">0.58&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:58%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>index_lookup</strong></td>
            <td class="num">103</td>
            <td class="num">107</td>
            <td class="num"><span class="faster">0.96&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:96%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>order_by</strong></td>
            <td class="num">194</td>
            <td class="num">372</td>
            <td class="num"><span class="faster">0.52&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:52%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>multi_sort</strong></td>
            <td class="num">271</td>
            <td class="num">506</td>
            <td class="num"><span class="faster">0.54&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:54%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>distinct</strong></td>
            <td class="num">37</td>
            <td class="num">257</td>
            <td class="num"><span class="faster">0.14&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:14%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="5">writes</td></tr>
        <tr>
            <td><strong>insert_bulk</strong></td>
            <td class="num">325</td>
            <td class="num">872</td>
            <td class="num"><span class="faster">0.37&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:37%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>update</strong></td>
            <td class="num">46</td>
            <td class="num">231</td>
            <td class="num"><span class="faster">0.20&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:20%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>delete</strong></td>
            <td class="num">2,964</td>
            <td class="num">7,976</td>
            <td class="num"><span class="faster">0.37&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:37%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>transaction</strong></td>
            <td class="num">180</td>
            <td class="num">191</td>
            <td class="num"><span class="faster">0.94&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:94%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="5">advanced queries</td></tr>
        <tr>
            <td><strong>aggregate</strong></td>
            <td class="num">31</td>
            <td class="num">274</td>
            <td class="num"><span class="faster">0.11&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:11%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>join</strong></td>
            <td class="num">26</td>
            <td class="num">58</td>
            <td class="num"><span class="faster">0.45&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:45%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>window_functions</strong></td>
            <td class="num">50</td>
            <td class="num">88</td>
            <td class="num"><span class="faster">0.56&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:56%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>subquery</strong></td>
            <td class="num">40</td>
            <td class="num">93</td>
            <td class="num"><span class="faster">0.43&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:43%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>cte</strong></td>
            <td class="num">50</td>
            <td class="num">113</td>
            <td class="num"><span class="faster">0.44&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:44%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>set_ops</strong></td>
            <td class="num">52</td>
            <td class="num">98</td>
            <td class="num"><span class="faster">0.53&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:53%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>generate_series</strong></td>
            <td class="num">212</td>
            <td class="num">710</td>
            <td class="num"><span class="faster">0.30&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:30%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>scalar_functions</strong></td>
            <td class="num">358</td>
            <td class="num">944</td>
            <td class="num"><span class="faster">0.38&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:38%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>expression_agg</strong></td>
            <td class="num">304</td>
            <td class="num">313</td>
            <td class="num"><span class="faster">0.97&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:97%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
    </tbody>
</table>

<p>
    <strong>All 19 workloads faster.</strong>&ensp;The closest results are expression
    aggregates (0.97&times;), transactions (0.94&times;), and index lookups (0.96&times;).
</p>

<h2>3. Concurrent Throughput (4 threads, 5&nbsp;seconds)</h2>

<p>
    Ratio &gt;&nbsp;1.0 means mskql has higher throughput.
</p>

<div class="legend">
    <span><span class="legend-swatch" style="background:var(--accent)"></span>mskql</span>
    <span><span class="legend-swatch" style="background:#4a7ab5"></span>PostgreSQL</span>
</div>

<table style="table-layout:fixed">
    <colgroup>
        <col style="width:18%">
        <col style="width:13%">
        <col style="width:13%">
        <col style="width:10%">
        <col style="width:13%">
        <col style="width:13%">
        <col style="width:20%">
    </colgroup>
    <thead>
        <tr>
            <th>Workload</th>
            <th class="num" style="text-align:right">mskql QPS</th>
            <th class="num" style="text-align:right">pg QPS</th>
            <th class="num" style="text-align:right">Ratio</th>
            <th class="num" style="text-align:right">mskql p50</th>
            <th class="num" style="text-align:right">pg p50</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>point_read</strong></td>
            <td class="num">51,786</td>
            <td class="num">46,882</td>
            <td class="num"><span class="tp-higher">1.10&times;</span></td>
            <td class="num">0.074&thinsp;ms</td>
            <td class="num">0.085&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:91%"></span></div></td>
        </tr>
        <tr>
            <td><strong>full_scan</strong></td>
            <td class="num">240</td>
            <td class="num">270</td>
            <td class="num"><span class="tp-lower">0.89&times;</span></td>
            <td class="num">14.9&thinsp;ms</td>
            <td class="num">13.7&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:89%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>filtered_scan</strong></td>
            <td class="num">484</td>
            <td class="num">548</td>
            <td class="num"><span class="tp-lower">0.88&times;</span></td>
            <td class="num">6.7&thinsp;ms</td>
            <td class="num">6.7&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:88%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>aggregate</strong></td>
            <td class="num">52,319</td>
            <td class="num">5,539</td>
            <td class="num"><span class="tp-higher">9.44&times;</span></td>
            <td class="num">0.073&thinsp;ms</td>
            <td class="num">0.727&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:11%"></span></div></td>
        </tr>
        <tr>
            <td><strong>join</strong></td>
            <td class="num">1,311</td>
            <td class="num">651</td>
            <td class="num"><span class="tp-higher">2.01&times;</span></td>
            <td class="num">2.8&thinsp;ms</td>
            <td class="num">5.4&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:50%"></span></div></td>
        </tr>
        <tr>
            <td><strong>insert</strong></td>
            <td class="num">57,217</td>
            <td class="num">27,840</td>
            <td class="num"><span class="tp-higher">2.06&times;</span></td>
            <td class="num">0.067&thinsp;ms</td>
            <td class="num">0.135&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:49%"></span></div></td>
        </tr>
        <tr>
            <td><strong>mixed_rw</strong></td>
            <td class="num">45,473</td>
            <td class="num">42,892</td>
            <td class="num"><span class="tp-higher">1.06&times;</span></td>
            <td class="num">0.083&thinsp;ms</td>
            <td class="num">0.085&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:94%"></span></div></td>
        </tr>
    </tbody>
</table>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  SO WHAT: The honest picture                                -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>4. The Honest Picture</h2>

<h3>Where mskql wins</h3>

<p>
    <strong>Aggregate: 0.11&times; (9&times; faster).</strong>
    <strong>Distinct: 0.14&times; (7&times; faster).</strong>
    Both driven by the block-oriented plan executor&mdash;1,024-row column blocks
    serialized directly to the wire without row materialization.
</p>

<p>
    Write workloads benefit from zero durability overhead: no fsync, no WAL.
    Updates at 0.20&times; and inserts at 0.37&times; reflect the in-memory advantage.
    Transactions now run at 0.94&times; thanks to lazy copy-on-write snapshots.
</p>

<p>
    Under concurrent load, aggregate throughput is 9.4&times; PostgreSQL&rsquo;s
    (52,319 vs 5,539 QPS). Insert throughput is 2.06&times;. Join throughput is 2.01&times;.
    Point reads and mixed R/W also favor mskql.
</p>

<h3>Where PostgreSQL is close</h3>

<p>
    <strong>Full scans and filtered scans: 0.89&times; / 0.88&times; throughput.</strong>
    Both databases are network-bound under concurrent load&mdash;serializing
    thousands of rows over the wire. The scan itself is fast in both.
    In batch mode mskql still wins (0.65&times; / 0.58&times;).
</p>

<p>
    <strong>Expression aggregates: 0.97&times;.</strong>
    Complex expressions in aggregates are evaluated per-row in both engines.
    The gap is narrow.
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  NOW WHAT: Next steps and reproduction                      -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>5. What&rsquo;s Next</h2>

<p>
    The remaining throughput gaps (full_scan, filtered_scan) are network-bound.
    The batch results show mskql faster across all 19 workloads. The query engine
    is competitive or faster across the board.
</p>

<h2>6. Running It Yourself</h2>

<h3>Batch latency</h3>
<pre><code class="language-bash"># Start mskql in one terminal
./build/mskql

# In another terminal, with PostgreSQL running:
./bench/bench_vs_pg.sh</code></pre>

<h3>Concurrent throughput</h3>
<pre><code class="language-bash"># Build the throughput benchmark
make -C bench bench_throughput

# Run (requires both mskql and PostgreSQL running)
./build/mskql_bench_tp --duration 5 --threads 4 --pg</code></pre>

<p>
    The batch script auto-creates a <code>mskql_bench</code> database in PostgreSQL if it
    doesn&rsquo;t exist. The throughput benchmark requires <code>libpq</code> headers
    at build time.
</p>

<footer class="site-footer">
    <a href="index.html">mskql</a>
    &ensp;&middot;&ensp;
    <a href="https://github.com/martinsk/mskql">Source on GitHub</a>
    &ensp;&middot;&ensp;
    <a href="dev/bench/index.html">Historical Charts</a>
    &ensp;&middot;&ensp;
    <a href="grammar.html">SQL Grammar</a>
</footer>

</body>
</html>
