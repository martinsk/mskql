<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mskql &mdash; mskql vs PostgreSQL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .caveat {
            border: 1.5px solid var(--accent);
            border-radius: 6px;
            padding: 1rem 1.2rem;
            margin: 1.6rem 0;
            background: #fff;
        }
        .caveat strong { color: var(--accent); }

        .faster { color: #1a7a1a; font-weight: 600; }
        .slower { color: var(--accent); font-weight: 600; }

        td.num, th.num { white-space: nowrap; text-align: right; }
        .bar-cell { padding: 0.4rem 0.4rem 0.4rem 0.8rem; }
        .bar-wrap {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .bar {
            height: 14px;
            border-radius: 2px;
            min-width: 2px;
        }
        .bar-mskql { background: var(--accent); }
        .bar-pg { background: #4a7ab5; }

        .legend {
            display: flex;
            gap: 1.5rem;
            font-size: 0.95rem;
            color: var(--fg-dim);
            margin-bottom: 0.8rem;
        }
        .legend-swatch {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 2px;
            vertical-align: middle;
            margin-right: 0.3rem;
        }

        .group-label td {
            padding-top: 1rem;
            font-variant: small-caps;
            letter-spacing: 0.04em;
            font-size: 0.85rem;
            color: var(--fg-dim);
            border-bottom: 1px solid var(--rule);
        }

        .tp-higher { color: #1a7a1a; font-weight: 600; }
        .tp-lower { color: var(--accent); font-weight: 600; }
    </style>
</head>
<body>

<p class="breadcrumb"><a href="index.html">&larr; mskql</a></p>

<h1>mskql vs PostgreSQL</h1>
<span class="subtitle">Two benchmarks, one honest picture</span>
<p class="byline">
    <a href="index.html">&#8592; back to main page</a>
</p>
<hr class="title-rule">

<p>
    <strong>mskql is faster than PostgreSQL in all 26 batch workloads.
    Expression aggregates run 10&times; faster. Updates 5&times;. Inserts 3&times;.</strong>
    Under concurrent load (8&nbsp;threads), mskql wins 12 of 14 workloads.
    An analytical pipeline (CTE&nbsp;&rarr; join&nbsp;&rarr; aggregate&nbsp;&rarr; sort)
    runs at 152&times; PostgreSQL&rsquo;s throughput. The only loss:
    mixed read/write at 0.78&times;&mdash;PostgreSQL&rsquo;s MVCC handles concurrent
    writes better.
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  WHAT: Setup and framing                                    -->
<!-- ═══════════════════════════════════════════════════════════ -->

<div class="caveat">
    <strong>&#9888; Important caveat.</strong>&ensp;This comparison is <em>unscientific</em>
    and intended only as a directional indicator. mskql is an in-memory toy database with
    no durability, no MVCC, no WAL, no background workers, and no query optimizer.
    PostgreSQL is a production-grade RDBMS with decades of engineering behind it.
    The numbers below measure wall-clock time for identical SQL workloads over a loopback
    TCP connection&mdash;not raw engine speed. Take them as a rough sense of where mskql
    sits, not as a serious benchmark.
</div>

<h2>1. Methodology</h2>

<h3>Batch latency</h3>
<p>
    Both databases are tested on the same Apple&nbsp;M-series laptop, same loopback interface,
    using the same <code>psql</code> client. The benchmark script
    (<code>bench/bench_vs_pg.py</code>) generates identical SQL workloads for each test,
    runs setup against both databases, then times the benchmark queries. Each timing measures
    a single <code>psql&nbsp;-f</code> invocation containing all iterations of that workload.
    mskql runs on port&nbsp;5433; PostgreSQL on port&nbsp;5432 with default configuration.
</p>

<h3>Concurrent throughput</h3>
<p>
    A multi-threaded C benchmark (<code>bench/bench_throughput.c</code>) opens 8 persistent
    connections speaking raw pgwire and fires queries for 5&nbsp;seconds per workload.
    Measures QPS and median latency (p50).
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  SO WHAT: The data                                          -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>2. Batch Latency (single client, sequential)</h2>

<p>
    Ratio &lt;&nbsp;1.0 means mskql was faster; &gt;&nbsp;1.0 means PostgreSQL was faster.
    Results vary between runs&mdash;treat these as order-of-magnitude indicators.
</p>

<div class="legend">
    <span><span class="legend-swatch" style="background:var(--accent)"></span>mskql</span>
    <span><span class="legend-swatch" style="background:#4a7ab5"></span>PostgreSQL</span>
</div>

<table style="table-layout:fixed">
    <colgroup>
        <col style="width:32%">
        <col style="width:12%">
        <col style="width:12%">
        <col style="width:10%">
        <col style="width:34%">
    </colgroup>
    <thead>
        <tr>
            <th>What it does</th>
            <th class="num" style="text-align:right">mskql&ensp;(ms)</th>
            <th class="num" style="text-align:right">pg&ensp;(ms)</th>
            <th class="num" style="text-align:right">Ratio</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr class="group-label"><td colspan="5">reads &amp; scans</td></tr>
        <tr>
            <td><strong>SELECT * on 5K rows</strong> &times;200</td>
            <td class="num">301</td>
            <td class="num">444</td>
            <td class="num"><span class="faster">0.68&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:68%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>WHERE filter on 5K rows</strong> &times;500</td>
            <td class="num">366</td>
            <td class="num">623</td>
            <td class="num"><span class="faster">0.59&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:59%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>Indexed point lookup</strong> &times;2K</td>
            <td class="num">105</td>
            <td class="num">108</td>
            <td class="num"><span class="faster">0.98&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:98%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>ORDER BY on 5K rows</strong> &times;200</td>
            <td class="num">204</td>
            <td class="num">365</td>
            <td class="num"><span class="faster">0.56&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:56%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>Multi-column sort on 5K rows</strong> &times;200</td>
            <td class="num">281</td>
            <td class="num">517</td>
            <td class="num"><span class="faster">0.54&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:54%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>DISTINCT on 100 categories</strong> &times;500</td>
            <td class="num">37</td>
            <td class="num">266</td>
            <td class="num"><span class="faster">0.14&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:14%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="5">writes</td></tr>
        <tr>
            <td><strong>10K single-row INSERTs</strong></td>
            <td class="num">314</td>
            <td class="num">856</td>
            <td class="num"><span class="faster">0.37&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:37%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>UPDATE 1K of 5K rows</strong> &times;200</td>
            <td class="num">49</td>
            <td class="num">242</td>
            <td class="num"><span class="faster">0.20&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:20%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>Insert 2K + delete half</strong> &times;50</td>
            <td class="num">2,909</td>
            <td class="num">8,029</td>
            <td class="num"><span class="faster">0.36&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:36%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>100 txns, 50 inserts each</strong></td>
            <td class="num">175</td>
            <td class="num">188</td>
            <td class="num"><span class="faster">0.93&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:93%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="5">aggregation &amp; analytics</td></tr>
        <tr>
            <td><strong>GROUP BY + SUM on 5K rows</strong> &times;500</td>
            <td class="num">33</td>
            <td class="num">282</td>
            <td class="num"><span class="faster">0.12&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:12%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>SUM(price&times;qty) by category</strong> &times;500</td>
            <td class="num">33</td>
            <td class="num">322</td>
            <td class="num"><span class="faster">0.10&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:10%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>7-col agg (COUNT,AVG,SUM,MIN,MAX) 50K rows</strong> &times;20</td>
            <td class="num">23</td>
            <td class="num">163</td>
            <td class="num"><span class="faster">0.14&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:14%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>ROW_NUMBER() OVER on 5K rows</strong> &times;20</td>
            <td class="num">52</td>
            <td class="num">92</td>
            <td class="num"><span class="faster">0.57&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:57%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>RANK() OVER on 50K rows</strong> &times;5</td>
            <td class="num">128</td>
            <td class="num">231</td>
            <td class="num"><span class="faster">0.55&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:55%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="5">joins, subqueries &amp; complex queries</td></tr>
        <tr>
            <td><strong>500 users JOIN 2K orders</strong> &times;50</td>
            <td class="num">28</td>
            <td class="num">62</td>
            <td class="num"><span class="faster">0.45&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:45%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>3-table join + GROUP BY, 50K rows</strong> &times;5</td>
            <td class="num">35</td>
            <td class="num">106</td>
            <td class="num"><span class="faster">0.33&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:33%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>WHERE id IN (SELECT&hellip;)</strong> &times;50</td>
            <td class="num">43</td>
            <td class="num">99</td>
            <td class="num"><span class="faster">0.44&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:44%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>IN subquery + WHERE + sort + limit, 50K</strong> &times;20</td>
            <td class="num">27</td>
            <td class="num">138</td>
            <td class="num"><span class="faster">0.20&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:20%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>CTE filter chain on 5K rows</strong> &times;200</td>
            <td class="num">52</td>
            <td class="num">118</td>
            <td class="num"><span class="faster">0.44&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:44%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>CTE &rarr; agg &rarr; sort &rarr; limit, 50K</strong> &times;20</td>
            <td class="num">59</td>
            <td class="num">79</td>
            <td class="num"><span class="faster">0.75&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:75%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>CTE &rarr; join &rarr; agg &rarr; sort, 50K</strong> &times;5</td>
            <td class="num">31</td>
            <td class="num">77</td>
            <td class="num"><span class="faster">0.40&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:40%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>UNION of two 2K-row tables</strong> &times;50</td>
            <td class="num">55</td>
            <td class="num">101</td>
            <td class="num"><span class="faster">0.54&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:54%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="5">functions &amp; generation</td></tr>
        <tr>
            <td><strong>generate_series(1, 10000)</strong> &times;200</td>
            <td class="num">215</td>
            <td class="num">674</td>
            <td class="num"><span class="faster">0.32&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:32%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr>
            <td><strong>UPPER, LENGTH, ABS, ROUND on 5K rows</strong> &times;200</td>
            <td class="num">384</td>
            <td class="num">963</td>
            <td class="num"><span class="faster">0.40&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:40%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="5">large dataset (50K rows)</td></tr>
        <tr>
            <td><strong>ORDER BY on 50K rows</strong> &times;10</td>
            <td class="num">313</td>
            <td class="num">359</td>
            <td class="num"><span class="faster">0.87&times;</span></td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:87%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
    </tbody>
</table>

<p>
    <strong>All 26 workloads faster.</strong>&ensp;The closest results are index lookups
    (0.98&times;), transactions (0.93&times;), and sorting 50K rows (0.87&times;).
</p>

<h2>3. Concurrent Throughput (8 threads, 5&nbsp;seconds)</h2>

<p>
    Ratio &gt;&nbsp;1.0 means mskql has higher throughput.
</p>

<div class="legend">
    <span><span class="legend-swatch" style="background:var(--accent)"></span>mskql</span>
    <span><span class="legend-swatch" style="background:#4a7ab5"></span>PostgreSQL</span>
</div>

<table style="table-layout:fixed">
    <colgroup>
        <col style="width:28%">
        <col style="width:12%">
        <col style="width:12%">
        <col style="width:10%">
        <col style="width:11%">
        <col style="width:11%">
        <col style="width:16%">
    </colgroup>
    <thead>
        <tr>
            <th>What it does</th>
            <th class="num" style="text-align:right">mskql QPS</th>
            <th class="num" style="text-align:right">pg QPS</th>
            <th class="num" style="text-align:right">Ratio</th>
            <th class="num" style="text-align:right">mskql p50</th>
            <th class="num" style="text-align:right">pg p50</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr class="group-label"><td colspan="7">simple reads &amp; writes</td></tr>
        <tr>
            <td><strong>Indexed single-row lookup</strong></td>
            <td class="num">78,600</td>
            <td class="num">23,461</td>
            <td class="num"><span class="tp-higher">3.35&times;</span></td>
            <td class="num">0.101&thinsp;ms</td>
            <td class="num">0.254&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:30%"></span></div></td>
        </tr>
        <tr>
            <td><strong>SELECT * on 5K rows</strong></td>
            <td class="num">121</td>
            <td class="num">120</td>
            <td class="num"><span class="tp-higher">1.00&times;</span></td>
            <td class="num">66.0&thinsp;ms</td>
            <td class="num">65.8&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:99%"></span></div></td>
        </tr>
        <tr>
            <td><strong>WHERE filter on 5K rows</strong></td>
            <td class="num">245</td>
            <td class="num">241</td>
            <td class="num"><span class="tp-higher">1.02&times;</span></td>
            <td class="num">32.6&thinsp;ms</td>
            <td class="num">33.0&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:98%"></span></div></td>
        </tr>
        <tr>
            <td><strong>Single-row INSERT</strong></td>
            <td class="num">63,253</td>
            <td class="num">39,189</td>
            <td class="num"><span class="tp-higher">1.61&times;</span></td>
            <td class="num">0.115&thinsp;ms</td>
            <td class="num">0.195&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:62%"></span></div></td>
        </tr>
        <tr>
            <td><strong>80% reads / 20% writes</strong></td>
            <td class="num">45,252</td>
            <td class="num">58,001</td>
            <td class="num"><span class="tp-lower">0.78&times;</span></td>
            <td class="num">0.155&thinsp;ms</td>
            <td class="num">0.127&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:78%"></span><span class="bar bar-pg" style="width:100%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="7">aggregation &amp; analytics</td></tr>
        <tr>
            <td><strong>GROUP BY + SUM, 5K rows</strong></td>
            <td class="num">60,541</td>
            <td class="num">10,042</td>
            <td class="num"><span class="tp-higher">6.03&times;</span></td>
            <td class="num">0.128&thinsp;ms</td>
            <td class="num">0.652&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:17%"></span></div></td>
        </tr>
        <tr>
            <td><strong>7-col agg on 50K rows</strong></td>
            <td class="num">5,386</td>
            <td class="num">786</td>
            <td class="num"><span class="tp-higher">6.85&times;</span></td>
            <td class="num">1.471&thinsp;ms</td>
            <td class="num">10.8&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:15%"></span></div></td>
        </tr>
        <tr>
            <td><strong>RANK() OVER on 50K rows</strong></td>
            <td class="num">14</td>
            <td class="num">12</td>
            <td class="num"><span class="tp-higher">1.22&times;</span></td>
            <td class="num">636.6&thinsp;ms</td>
            <td class="num">652.7&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:82%"></span></div></td>
        </tr>
        <tr class="group-label"><td colspan="7">complex queries (50K-row dataset)</td></tr>
        <tr>
            <td><strong>500 users JOIN 2K orders</strong></td>
            <td class="num">562</td>
            <td class="num">302</td>
            <td class="num"><span class="tp-higher">1.86&times;</span></td>
            <td class="num">14.1&thinsp;ms</td>
            <td class="num">26.3&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:54%"></span></div></td>
        </tr>
        <tr>
            <td><strong>3-table join + GROUP BY</strong></td>
            <td class="num">23,560</td>
            <td class="num">370</td>
            <td class="num"><span class="tp-higher">63.6&times;</span></td>
            <td class="num">0.354&thinsp;ms</td>
            <td class="num">22.3&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:2%"></span></div></td>
        </tr>
        <tr>
            <td><strong>CTE &rarr; agg &rarr; sort &rarr; limit</strong></td>
            <td class="num">5,606</td>
            <td class="num">1,920</td>
            <td class="num"><span class="tp-higher">2.92&times;</span></td>
            <td class="num">1.430&thinsp;ms</td>
            <td class="num">4.312&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:34%"></span></div></td>
        </tr>
        <tr>
            <td><strong>IN subquery + filter + sort + limit</strong></td>
            <td class="num">1,170</td>
            <td class="num">898</td>
            <td class="num"><span class="tp-higher">1.30&times;</span></td>
            <td class="num">6.698&thinsp;ms</td>
            <td class="num">8.775&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:77%"></span></div></td>
        </tr>
        <tr>
            <td><strong>ORDER BY on 50K rows</strong></td>
            <td class="num">30</td>
            <td class="num">12</td>
            <td class="num"><span class="tp-higher">2.54&times;</span></td>
            <td class="num">212.8&thinsp;ms</td>
            <td class="num">661.0&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:39%"></span></div></td>
        </tr>
        <tr>
            <td><strong>CTE &rarr; join &rarr; agg &rarr; sort</strong></td>
            <td class="num">74,069</td>
            <td class="num">485</td>
            <td class="num"><span class="tp-higher">152.5&times;</span></td>
            <td class="num">0.109&thinsp;ms</td>
            <td class="num">18.4&thinsp;ms</td>
            <td class="bar-cell"><div class="bar-wrap"><span class="bar bar-mskql" style="width:100%"></span><span class="bar bar-pg" style="width:1%"></span></div></td>
        </tr>
    </tbody>
</table>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  SO WHAT: The honest picture                                -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>4. The Honest Picture</h2>

<h3>Where mskql wins big</h3>

<p>
    <strong>Analytical pipeline: 152&times; throughput.</strong>
    The query &ldquo;CTE &rarr; join &rarr; aggregate &rarr; join &rarr; aggregate &rarr; sort&rdquo;
    on a 50K-row star schema runs at 74,069 QPS vs PostgreSQL&rsquo;s 485.
    The result is small (4 rows) and fits entirely in mskql&rsquo;s result cache
    after the first execution. Subsequent queries are served from cached wire bytes
    in microseconds. PostgreSQL re-executes the full plan every time.
</p>

<p>
    <strong>3-table join + GROUP BY: 64&times; throughput.</strong>
    Same mechanism: the columnar hash-join executor builds the result once,
    the result cache replays it. PostgreSQL&rsquo;s planner overhead dominates
    at this query size.
</p>

<p>
    <strong>Aggregation: 0.10&ndash;0.14&times; batch, 6&times; throughput.</strong>
    The block-oriented executor processes 1,024-row column blocks and serializes
    directly to the wire&mdash;no row materialization. Expression aggregates
    like <code>SUM(price&nbsp;*&nbsp;quantity)</code> are 10&times; faster in batch mode.
</p>

<p>
    Write workloads benefit from zero durability overhead: no fsync, no WAL.
    Updates at 0.20&times; and inserts at 0.37&times; reflect the in-memory advantage.
    Transactions run at 0.93&times; thanks to lazy copy-on-write snapshots.
</p>

<h3>Where PostgreSQL is close or wins</h3>

<p>
    <strong>Full scans and filtered scans: ~1.0&times; throughput.</strong>
    Both databases are network-bound under concurrent load&mdash;serializing
    thousands of rows over the wire. The scan itself is fast in both.
    In batch mode mskql still wins (0.68&times; / 0.59&times;).
</p>

<p>
    <strong>Mixed read/write: 0.78&times; throughput.</strong>
    This is the only workload where PostgreSQL has higher QPS.
    The mix is 80% indexed reads + 20% updates. PostgreSQL&rsquo;s MVCC
    allows concurrent readers and writers without blocking; mskql&rsquo;s
    single-threaded executor serializes all queries.
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  NOW WHAT: Next steps and reproduction                      -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>5. What&rsquo;s Next</h2>

<p>
    The remaining throughput gap (mixed read/write) is a concurrency limitation:
    mskql serializes all queries on a single thread. The batch results show mskql
    faster across all 26 workloads. The query engine is competitive or faster
    across the board.
</p>

<h2>6. Running It Yourself</h2>

<h3>Batch latency</h3>
<pre><code class="language-bash"># Start mskql in one terminal
./build/mskql

# In another terminal, with PostgreSQL running:
./bench/bench_vs_pg.sh</code></pre>

<h3>Concurrent throughput</h3>
<pre><code class="language-bash"># Build the throughput benchmark
make -C bench bench_throughput

# Run (requires both mskql and PostgreSQL running)
./build/mskql_bench_tp --duration 5 --threads 8 --pg</code></pre>

<p>
    The batch script auto-creates a <code>mskql_bench</code> database in PostgreSQL if it
    doesn&rsquo;t exist. The throughput benchmark requires <code>libpq</code> headers
    at build time.
</p>

<footer class="site-footer">
    <a href="index.html">mskql</a>
    &ensp;&middot;&ensp;
    <a href="https://github.com/martinsk/mskql">Source on GitHub</a>
    &ensp;&middot;&ensp;
    <a href="dev/bench/index.html">Historical Charts</a>
    &ensp;&middot;&ensp;
    <a href="grammar.html">SQL Grammar</a>
</footer>

</body>
</html>
