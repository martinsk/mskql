<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mskql &mdash; Tutorial: Sequences, Enums &amp; Custom Types</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="tutorial.css">
    <link rel="stylesheet" href="tutorial-interactive.css">
</head>
<body>

<aside class="sidebar">
    <div class="sidebar-title"><a href="../index.html">mskql</a></div>
    <div class="sidebar-subtitle"><a href="index.html">Tutorials</a></div>
    <nav>
        <ul>
            <li><a href="task-tracker.html">1. Task Tracker</a></li>
            <li><a href="reporting-dashboard.html">2. Reporting Dashboard</a></li>
            <li><a href="time-series.html">3. Time-Series Analytics</a></li>
            <li><a href="multi-table-joins.html">4. Multi-Table Joins</a></li>
            <li><a href="schema-evolution.html">5. Schema Evolution</a></li>
            <li><a href="recursive-ctes.html">6. Recursive CTEs</a></li>
            <li><a href="set-operations.html">7. Set Operations</a></li>
            <li><a href="string-math-functions.html">8. String &amp; Math</a></li>
            <li><a href="indexes-performance.html">9. Indexes</a></li>
            <li><a href="sequences-enums.html" class="active">10. Sequences &amp; Enums</a></li>
        </ul>
        <div class="nav-label">Reference</div>
        <ul>
            <li><a href="../grammar.html">SQL Grammar</a></li>
            <li><a href="../bench-vs-pg.html">Benchmarks</a></li>
        </ul>
    </nav>
</aside>

<h1>Sequences, Enums &amp; Custom Types</h1>
<span class="subtitle">SERIAL deep dive, CREATE SEQUENCE, and CREATE TYPE AS ENUM</span>
<p class="byline">Tutorial 10 of 11</p>
<hr class="title-rule">

<p>
    Every <code>SERIAL</code> column you have used in previous tutorials is
    backed by a <strong>sequence</strong>&mdash;a named counter that generates
    unique integers. This tutorial peels back the abstraction, shows you how
    to create and control sequences directly, and introduces
    <strong>enum types</strong> for columns with a fixed set of allowed values.
</p>

<!-- ─── SERIAL deep dive ───────────────────────────────────── -->

<h2>1. SERIAL under the hood</h2>

<p>
    <code>SERIAL</code> is syntactic sugar. When you write
    <code>id SERIAL PRIMARY KEY</code>, mskql creates a sequence named
    <code>&lt;table&gt;_&lt;column&gt;_seq</code> and sets the column&rsquo;s
    default to <code>NEXTVAL('&lt;seq&gt;')</code>.
</p>

<pre><code class="language-sql">CREATE TABLE items (
    id   SERIAL PRIMARY KEY,
    name TEXT NOT NULL
);

INSERT INTO items (name) VALUES ('Alpha'), ('Beta'), ('Gamma');</code></pre>

<div class="query-pair">
<pre><code class="language-sql">SELECT * FROM items ORDER BY id;</code></pre>
<div class="result-wrap">
<p class="result-label">Result &mdash; IDs auto-assigned 1, 2, 3</p>
<table class="result-table">
<thead><tr><th>id</th><th>name</th></tr></thead>
<tbody>
<tr><td class="num-val">1</td><td>Alpha</td></tr>
<tr><td class="num-val">2</td><td>Beta</td></tr>
<tr><td class="num-val">3</td><td>Gamma</td></tr>
</tbody>
</table>
</div>
</div>

<!-- ─── CREATE SEQUENCE ────────────────────────────────────── -->

<h2>2. CREATE SEQUENCE explicitly</h2>

<p>
    Create a sequence with custom start, increment, and bounds. This is
    useful when you need invoice numbers starting at 1000, or IDs that
    increment by 10.
</p>

<pre><code class="language-sql">CREATE SEQUENCE invoice_seq START 1000 INCREMENT 1;

CREATE TABLE invoices (
    id       INT PRIMARY KEY DEFAULT NEXTVAL('invoice_seq'),
    customer TEXT NOT NULL,
    amount   INT NOT NULL
);

INSERT INTO invoices (customer, amount) VALUES
    ('Acme Corp',  500),
    ('Globex Inc', 1200),
    ('Initech',    750);</code></pre>

<div class="query-pair">
<pre><code class="language-sql">SELECT * FROM invoices ORDER BY id;</code></pre>
<div class="result-wrap">
<p class="result-label">Result &mdash; IDs start at 1000</p>
<table class="result-table">
<thead><tr><th>id</th><th>customer</th><th>amount</th></tr></thead>
<tbody>
<tr><td class="num-val">1000</td><td>Acme Corp</td><td class="num-val">500</td></tr>
<tr><td class="num-val">1001</td><td>Globex Inc</td><td class="num-val">1200</td></tr>
<tr><td class="num-val">1002</td><td>Initech</td><td class="num-val">750</td></tr>
</tbody>
</table>
</div>
</div>

<!-- ─── NEXTVAL directly ───────────────────────────────────── -->

<h2>3. Using NEXTVAL directly</h2>

<p>
    You can call <code>NEXTVAL</code> in any expression&mdash;not just as a
    column default. This is useful for generating IDs before inserting, or
    for numbering rows in a query.
</p>

<pre><code class="language-sql">CREATE SEQUENCE batch_seq START 1;

SELECT NEXTVAL('batch_seq') AS batch_1;
SELECT NEXTVAL('batch_seq') AS batch_2;
SELECT NEXTVAL('batch_seq') AS batch_3;</code></pre>

<p>
    Each call returns the next value: 1, 2, 3. The sequence never goes
    backward&mdash;even if a transaction rolls back, consumed values are gone.
</p>

<!-- ─── CREATE TYPE AS ENUM ────────────────────────────────── -->

<h2>4. CREATE TYPE AS ENUM</h2>

<p>
    An enum type restricts a column to a fixed set of string values. Unlike a
    <code>CHECK</code> constraint, the allowed values are defined once and
    reused across multiple tables. Internally, mskql stores enums as 4-byte
    ordinals&mdash;not strings&mdash;so comparisons and sorting are integer-fast.
</p>

<pre><code class="language-sql">CREATE TYPE priority AS ENUM ('low', 'medium', 'high', 'critical');
CREATE TYPE status AS ENUM ('open', 'in_progress', 'resolved', 'closed');

CREATE TABLE tickets (
    id       SERIAL PRIMARY KEY,
    title    TEXT NOT NULL,
    priority priority NOT NULL DEFAULT 'medium',
    status   status NOT NULL DEFAULT 'open'
);

INSERT INTO tickets (title, priority, status) VALUES
    ('Login page broken',     'critical', 'open'),
    ('Update docs',           'low',      'in_progress'),
    ('Add dark mode',         'medium',   'open'),
    ('Fix memory leak',       'high',     'resolved'),
    ('Refactor auth module',  'medium',   'in_progress'),
    ('Upgrade dependencies',  'low',      'closed');</code></pre>

<!-- ─── Query with enum ────────────────────────────────────── -->

<h2>5. Querying enum columns</h2>

<p>
    Enum values behave like strings in <code>WHERE</code> clauses and
    <code>ORDER BY</code>. Ordering follows the declaration order (low &lt;
    medium &lt; high &lt; critical), not alphabetical.
</p>

<div class="query-pair">
<pre><code class="language-sql">SELECT title, priority, status
FROM tickets
WHERE priority IN ('high', 'critical')
ORDER BY priority, title;</code></pre>
<div class="result-wrap">
<p class="result-label">Result &mdash; ordinal order, not alphabetical</p>
<table class="result-table">
<thead><tr><th>title</th><th>priority</th><th>status</th></tr></thead>
<tbody>
<tr><td>Fix memory leak</td><td>high</td><td>resolved</td></tr>
<tr><td>Login page broken</td><td>critical</td><td>open</td></tr>
</tbody>
</table>
</div>
</div>

<!-- ─── Enum aggregation ───────────────────────────────────── -->

<h2>6. Aggregating by enum</h2>

<p>
    Group by an enum column to get counts per status or priority level.
</p>

<div class="query-pair">
<pre><code class="language-sql">SELECT status,
       COUNT(*) AS ticket_count
FROM tickets
GROUP BY status
ORDER BY status;</code></pre>
<div class="result-wrap">
<p class="result-label">Result &mdash; ordered by enum declaration</p>
<table class="result-table">
<thead><tr><th>status</th><th>ticket_count</th></tr></thead>
<tbody>
<tr><td>open</td><td class="num-val">2</td></tr>
<tr><td>in_progress</td><td class="num-val">2</td></tr>
<tr><td>resolved</td><td class="num-val">1</td></tr>
<tr><td>closed</td><td class="num-val">1</td></tr>
</tbody>
</table>
</div>
</div>

<!-- ─── Update enum ────────────────────────────────────────── -->

<h2>7. Updating enum values</h2>

<p>
    Update an enum column just like a text column. The value must be one of
    the declared enum values&mdash;anything else is an error.
</p>

<div class="query-pair">
<pre><code class="language-sql">UPDATE tickets
SET status = 'resolved',
    priority = 'high'
WHERE title = 'Login page broken'
RETURNING title, priority, status;</code></pre>
<div class="result-wrap">
<p class="result-label">Result</p>
<table class="result-table">
<thead><tr><th>title</th><th>priority</th><th>status</th></tr></thead>
<tbody>
<tr><td>Login page broken</td><td>high</td><td>resolved</td></tr>
</tbody>
</table>
</div>
</div>

<!-- ─── Drop type ──────────────────────────────────────────── -->

<h2>8. Drop a sequence or type</h2>

<p>
    Clean up with <code>DROP SEQUENCE</code> and <code>DROP TYPE</code>.
    You must drop tables using the type first.
</p>

<pre><code class="language-sql">DROP SEQUENCE batch_seq;</code></pre>

<p>
    The sequence is removed. Any column defaulting to
    <code>NEXTVAL('batch_seq')</code> will error on the next insert.
</p>

<!-- ─── Wrap-up ─────────────────────────────────────────────── -->

<h2>What you learned</h2>

<p>
    In this tutorial you explored the type system behind auto-incrementing
    IDs and constrained string columns:
</p>

<ul>
    <li><strong><code>SERIAL</code></strong> is syntactic sugar for a sequence + default</li>
    <li><strong><code>CREATE SEQUENCE</code></strong> with custom <code>START</code> and <code>INCREMENT</code></li>
    <li><strong><code>NEXTVAL('seq')</code></strong> to consume the next value from a sequence</li>
    <li><strong><code>CREATE TYPE AS ENUM</code></strong> for fixed-set string columns</li>
    <li><strong>Enum ordering</strong> follows declaration order, not alphabetical</li>
    <li><strong>Enum storage</strong>: 4-byte ordinals internally, string display externally</li>
    <li><strong><code>DROP SEQUENCE</code> / <code>DROP TYPE</code></strong> for cleanup</li>
</ul>

<div class="tutorial-nav">
    <a class="prev" href="indexes-performance.html">Indexes &amp; Performance</a>
    <span></span>
</div>

<footer class="site-footer">
    <a href="https://www.linkedin.com/in/martinskristiansen">Martin S. Kristiansen</a>
    &ensp;&middot;&ensp;
    <a href="https://github.com/martinsk/mskql">Source on GitHub</a>
    &ensp;&middot;&ensp;
    <a href="../index.html">Documentation</a>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
<script>hljs.highlightAll();</script>
<script src="../wasm/mskql-wasm.js"></script>
<script src="tutorial-interactive.js"></script>
</body>
</html>
