<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mskql &mdash; SQL Grammar Reference</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* ── Grammar production rules (page-specific) ──────────── */
        .grammar {
            font-family: 'Menlo', 'Consolas', 'DejaVu Sans Mono', monospace;
            font-size: 0.8rem;
            line-height: 1.7;
            background: var(--code-bg);
            border-left: 3px solid var(--accent);
            padding: 1rem 1.2rem;
            margin: 0.8rem 0 1.4rem 0;
            overflow-x: auto;
        }
        .grammar .kw {
            font-weight: 700;
            color: var(--fg);
        }
        .grammar .nt {
            font-style: italic;
            color: #36c;
        }
        .grammar .op {
            color: var(--accent);
            font-weight: 700;
        }
        .grammar .comment {
            color: var(--fg-dim);
            font-style: italic;
        }

        /* ── Status badges ─────────────────────────────────────── */
        .badge {
            display: inline-block;
            font-family: 'Menlo', 'Consolas', monospace;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.03em;
            padding: 0.15em 0.5em;
            border-radius: 3px;
            vertical-align: middle;
            margin-left: 0.4rem;
        }
        .badge-no {
            display: inline;
            font-family: 'EB Garamond', Georgia, serif;
            font-size: 0.75rem;
            font-style: italic;
            font-weight: 400;
            color: var(--fg-dim);
            background: none;
            border: none;
            padding: 0;
            margin-left: 0.3rem;
            vertical-align: baseline;
            letter-spacing: 0;
        }
    </style>
</head>
<body>

<p class="breadcrumb"><a href="index.html">&larr; mskql</a></p>

<h1>SQL Grammar</h1>
<span class="subtitle">Every production rule accepted by the recursive-descent parser</span>
<hr class="title-rule">

<p>
    <strong>This page lists every production rule accepted by mskql&rsquo;s
    hand-written recursive-descent parser.</strong> Implemented features are
    unmarked; features not yet supported are noted inline in italics.
    See the <a href="sql-reference.html">SQL Reference</a> for a higher-level
    summary grouped by category.
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Statements                                                 -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>1. Top-Level Statements</h2>

<div class="grammar">
<span class="nt">statement</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="nt">select_stmt</span><br>
&ensp;&ensp;| <span class="nt">insert_stmt</span><br>
&ensp;&ensp;| <span class="nt">update_stmt</span><br>
&ensp;&ensp;| <span class="nt">delete_stmt</span><br>
&ensp;&ensp;| <span class="nt">create_table_stmt</span><br>
&ensp;&ensp;| <span class="nt">drop_table_stmt</span><br>
&ensp;&ensp;| <span class="nt">create_index_stmt</span><br>
&ensp;&ensp;| <span class="nt">drop_index_stmt</span><br>
&ensp;&ensp;| <span class="nt">create_type_stmt</span><br>
&ensp;&ensp;| <span class="nt">drop_type_stmt</span><br>
&ensp;&ensp;| <span class="nt">create_sequence_stmt</span><br>
&ensp;&ensp;| <span class="nt">drop_sequence_stmt</span><br>
&ensp;&ensp;| <span class="nt">create_view_stmt</span><br>
&ensp;&ensp;| <span class="nt">drop_view_stmt</span><br>
&ensp;&ensp;| <span class="nt">alter_table_stmt</span><br>
&ensp;&ensp;| <span class="nt">truncate_stmt</span><br>
&ensp;&ensp;| <span class="nt">copy_stmt</span><br>
&ensp;&ensp;| <span class="nt">transaction_stmt</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  SELECT                                                     -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>2. SELECT</h2>

<div class="grammar">
<span class="nt">select_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  [ <span class="nt">with_clause</span> ]<br>
&ensp;&ensp;  <span class="kw">SELECT</span> [ <span class="kw">DISTINCT</span> [ <span class="kw">ON</span> <span class="kw">(</span> <span class="nt">column_list</span> <span class="kw">)</span> ] ]<br>
&ensp;&ensp;  <span class="nt">select_list</span><br>
&ensp;&ensp;  [ <span class="kw">FROM</span> <span class="nt">from_clause</span> ]<br>
&ensp;&ensp;  [ <span class="nt">join_clause</span> ... ]<br>
&ensp;&ensp;  [ <span class="kw">WHERE</span> <span class="nt">condition</span> ]<br>
&ensp;&ensp;  [ <span class="kw">GROUP BY</span> <span class="nt">group_by_clause</span> ]<br>
&ensp;&ensp;  [ <span class="kw">HAVING</span> <span class="nt">condition</span> ]<br>
&ensp;&ensp;  [ <span class="nt">set_operation</span> ]<br>
&ensp;&ensp;  [ <span class="kw">ORDER BY</span> <span class="nt">order_list</span> ]<br>
&ensp;&ensp;  [ <span class="kw">LIMIT</span> <span class="nt">expr</span> ]<br>
&ensp;&ensp;  [ <span class="kw">OFFSET</span> <span class="nt">expr</span> ]<br>
</div>

<h3>WITH clause (CTEs)</h3>

<div class="grammar">
<span class="nt">with_clause</span> <span class="op">::=</span>
  <span class="kw">WITH</span> [ <span class="kw">RECURSIVE</span> ] <span class="nt">cte_def</span> { <span class="kw">,</span> <span class="nt">cte_def</span> }<br>
<br>
<span class="nt">cte_def</span> <span class="op">::=</span>
  <span class="nt">name</span> [ <span class="kw">(</span> <span class="nt">column_list</span> <span class="kw">)</span> ] <span class="kw">AS</span> <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span><br>
</div>

<h3>SELECT list</h3>

<div class="grammar">
<span class="nt">select_list</span> <span class="op">::=</span>
  <span class="kw">*</span>
  | <span class="nt">select_item</span> { <span class="kw">,</span> <span class="nt">select_item</span> }<br>
<br>
<span class="nt">select_item</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="nt">expr</span> [ [ <span class="kw">AS</span> ] <span class="nt">alias</span> ]<br>
&ensp;&ensp;| <span class="nt">agg_func</span> <span class="kw">(</span> [ <span class="kw">DISTINCT</span> ] <span class="nt">expr</span> <span class="kw">)</span> [ [ <span class="kw">AS</span> ] <span class="nt">alias</span> ]<br>
&ensp;&ensp;| <span class="nt">window_func</span> <span class="kw">(</span> <span class="nt">args</span> <span class="kw">)</span> <span class="kw">OVER</span> <span class="kw">(</span> <span class="nt">window_spec</span> <span class="kw">)</span> [ [ <span class="kw">AS</span> ] <span class="nt">alias</span> ]<br>
&ensp;&ensp;| <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span> [ [ <span class="kw">AS</span> ] <span class="nt">alias</span> ] <span class="comment">&ensp;-- scalar subquery</span><br>
</div>

<h3>FROM clause</h3>

<div class="grammar">
<span class="nt">from_clause</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="nt">table_name</span> [ [ <span class="kw">AS</span> ] <span class="nt">alias</span> ]<br>
&ensp;&ensp;| <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span> [ <span class="kw">AS</span> ] <span class="nt">alias</span> <span class="comment">&ensp;-- derived table</span><br>
&ensp;&ensp;| <span class="kw">generate_series</span> <span class="kw">(</span> <span class="nt">start</span> <span class="kw">,</span> <span class="nt">stop</span> [ <span class="kw">,</span> <span class="nt">step</span> ] <span class="kw">)</span> [ <span class="kw">AS</span> <span class="nt">alias</span> <span class="kw">(</span> <span class="nt">col_alias</span> <span class="kw">)</span> ]<br>
<span class="comment">&ensp;&ensp;-- integer series: generate_series(1, 100)</span><br>
<span class="comment">&ensp;&ensp;-- integer with step: generate_series(0, 100, 10)</span><br>
<span class="comment">&ensp;&ensp;-- timestamp series: generate_series('2024-01-01'::date, '2024-12-31'::date, '1 month')</span><br>
</div>

<h3>JOIN clause</h3>

<div class="grammar">
<span class="nt">join_clause</span> <span class="op">::=</span><br>
&ensp;&ensp;  [ <span class="kw">INNER</span> ] <span class="kw">JOIN</span> <span class="nt">table_ref</span> <span class="kw">ON</span> <span class="nt">condition</span><br>
&ensp;&ensp;| <span class="kw">LEFT</span> [ <span class="kw">OUTER</span> ] <span class="kw">JOIN</span> <span class="nt">table_ref</span> <span class="kw">ON</span> <span class="nt">condition</span><br>
&ensp;&ensp;| <span class="kw">RIGHT</span> [ <span class="kw">OUTER</span> ] <span class="kw">JOIN</span> <span class="nt">table_ref</span> <span class="kw">ON</span> <span class="nt">condition</span><br>
&ensp;&ensp;| <span class="kw">FULL</span> [ <span class="kw">OUTER</span> ] <span class="kw">JOIN</span> <span class="nt">table_ref</span> <span class="kw">ON</span> <span class="nt">condition</span><br>
&ensp;&ensp;| <span class="kw">CROSS JOIN</span> <span class="nt">table_ref</span><br>
&ensp;&ensp;| <span class="kw">NATURAL</span> [ <span class="kw">LEFT</span> | <span class="kw">RIGHT</span> | <span class="kw">FULL</span> ] <span class="kw">JOIN</span> <span class="nt">table_ref</span><br>
&ensp;&ensp;| ... <span class="kw">USING</span> <span class="kw">(</span> <span class="nt">column_list</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">LATERAL</span> <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span> [ <span class="kw">AS</span> ] <span class="nt">alias</span><br>
&ensp;&ensp;| <span class="kw">,</span> <span class="nt">table_ref</span> <span class="comment">&ensp;-- implicit cross join</span><br>
</div>

<h3>GROUP BY clause</h3>

<div class="grammar">
<span class="nt">group_by_clause</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="nt">column_ref</span> { <span class="kw">,</span> <span class="nt">column_ref</span> }<br>
&ensp;&ensp;| <span class="kw">ROLLUP</span> <span class="kw">(</span> <span class="nt">column_ref</span> { <span class="kw">,</span> <span class="nt">column_ref</span> } <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">CUBE</span> <span class="kw">(</span> <span class="nt">column_ref</span> { <span class="kw">,</span> <span class="nt">column_ref</span> } <span class="kw">)</span><br>
</div>

<h3>Set operations</h3>

<div class="grammar">
<span class="nt">set_operation</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">UNION</span> [ <span class="kw">ALL</span> ] <span class="nt">select_stmt</span><br>
&ensp;&ensp;| <span class="kw">INTERSECT</span> <span class="nt">select_stmt</span><br>
&ensp;&ensp;| <span class="kw">EXCEPT</span> <span class="nt">select_stmt</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Aggregate & Window functions                               -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>3. Aggregate &amp; Window Functions</h2>

<h3>Aggregate functions</h3>

<div class="grammar">
<span class="nt">agg_func</span> <span class="op">::=</span>
  <span class="kw">COUNT</span> | <span class="kw">SUM</span> | <span class="kw">AVG</span> | <span class="kw">MIN</span> | <span class="kw">MAX</span>
  | <span class="kw">STRING_AGG</span> | <span class="kw">ARRAY_AGG</span><br>
<br>
<span class="comment">-- COUNT(DISTINCT col) is supported</span><br>
<span class="comment">-- COUNT(*) is supported</span><br>
<span class="comment">-- STRING_AGG(expr, delimiter) is supported</span><br>
<span class="comment">-- ARRAY_AGG(expr) is supported</span><br>
</div>

<h3>Window functions</h3>

<div class="grammar">
<span class="nt">window_func</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">ROW_NUMBER</span> | <span class="kw">RANK</span> | <span class="kw">DENSE_RANK</span><br>
&ensp;&ensp;| <span class="kw">NTILE</span> | <span class="kw">PERCENT_RANK</span> | <span class="kw">CUME_DIST</span><br>
&ensp;&ensp;| <span class="kw">LAG</span> | <span class="kw">LEAD</span><br>
&ensp;&ensp;| <span class="kw">FIRST_VALUE</span> | <span class="kw">LAST_VALUE</span> | <span class="kw">NTH_VALUE</span><br>
&ensp;&ensp;| <span class="kw">SUM</span> | <span class="kw">COUNT</span> | <span class="kw">AVG</span><br>
<br>
<span class="nt">window_spec</span> <span class="op">::=</span><br>
&ensp;&ensp;  [ <span class="kw">PARTITION BY</span> <span class="nt">column_ref</span> ]<br>
&ensp;&ensp;  [ <span class="kw">ORDER BY</span> <span class="nt">column_ref</span> [ <span class="kw">ASC</span> | <span class="kw">DESC</span> ] ]<br>
&ensp;&ensp;  [ <span class="nt">frame_clause</span> ]<br>
<br>
<span class="nt">frame_clause</span> <span class="op">::=</span>
  <span class="kw">ROWS BETWEEN</span> <span class="nt">frame_bound</span> <span class="kw">AND</span> <span class="nt">frame_bound</span><br>
<br>
<span class="nt">frame_bound</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">UNBOUNDED PRECEDING</span><br>
&ensp;&ensp;| <span class="nt">n</span> <span class="kw">PRECEDING</span><br>
&ensp;&ensp;| <span class="kw">CURRENT ROW</span><br>
&ensp;&ensp;| <span class="nt">n</span> <span class="kw">FOLLOWING</span><br>
&ensp;&ensp;| <span class="kw">UNBOUNDED FOLLOWING</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  INSERT                                                     -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>4. INSERT</h2>

<div class="grammar">
<span class="nt">insert_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">INSERT INTO</span> <span class="nt">table_name</span> [ <span class="kw">(</span> <span class="nt">column_list</span> <span class="kw">)</span> ]<br>
&ensp;&ensp;  <span class="kw">VALUES</span> <span class="nt">value_tuple</span> { <span class="kw">,</span> <span class="nt">value_tuple</span> }<br>
&ensp;&ensp;  [ <span class="nt">conflict_clause</span> ]<br>
&ensp;&ensp;  [ <span class="kw">RETURNING</span> <span class="nt">select_list</span> ]<br>
<br>
&ensp;&ensp;| [ <span class="nt">with_clause</span> ] <span class="kw">INSERT INTO</span> <span class="nt">table_name</span> [ <span class="kw">(</span> <span class="nt">column_list</span> <span class="kw">)</span> ]<br>
&ensp;&ensp;&ensp;&ensp;<span class="nt">select_stmt</span> <span class="comment">&ensp;-- INSERT...SELECT, with optional CTE</span><br>
&ensp;&ensp;  [ <span class="nt">conflict_clause</span> ]<br>
&ensp;&ensp;  [ <span class="kw">RETURNING</span> <span class="nt">select_list</span> ]<br>
<br>
<span class="nt">conflict_clause</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">ON CONFLICT</span> [ <span class="kw">(</span> <span class="nt">column_ref</span> <span class="kw">)</span> ] <span class="kw">DO NOTHING</span><br>
&ensp;&ensp;| <span class="kw">ON CONFLICT</span> <span class="kw">(</span> <span class="nt">column_ref</span> <span class="kw">)</span> <span class="kw">DO UPDATE SET</span> <span class="nt">set_list</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  UPDATE                                                     -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>5. UPDATE</h2>

<div class="grammar">
<span class="nt">update_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">UPDATE</span> <span class="nt">table_name</span> [ [ <span class="kw">AS</span> ] <span class="nt">alias</span> ]<br>
&ensp;&ensp;  <span class="kw">SET</span> <span class="nt">set_list</span><br>
&ensp;&ensp;  [ <span class="kw">FROM</span> <span class="nt">table_name</span> [ [ <span class="kw">AS</span> ] <span class="nt">alias</span> ] ]<br>
&ensp;&ensp;  [ <span class="kw">WHERE</span> <span class="nt">condition</span> ]<br>
&ensp;&ensp;  [ <span class="kw">RETURNING</span> <span class="nt">select_list</span> ]<br>
<br>
<span class="nt">set_list</span> <span class="op">::=</span>
  <span class="nt">set_item</span> { <span class="kw">,</span> <span class="nt">set_item</span> }<br>
<br>
<span class="nt">set_item</span> <span class="op">::=</span>
  <span class="nt">column_name</span> <span class="kw">=</span> <span class="nt">expr</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  DELETE                                                     -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>6. DELETE</h2>

<div class="grammar">
<span class="nt">delete_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">DELETE FROM</span> <span class="nt">table_name</span><br>
&ensp;&ensp;  [ <span class="kw">WHERE</span> <span class="nt">condition</span> ]<br>
&ensp;&ensp;  [ <span class="kw">RETURNING</span> <span class="nt">select_list</span> ]<br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  DDL                                                        -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>7. Data Definition (DDL)</h2>

<h3>CREATE TABLE</h3>

<div class="grammar">
<span class="nt">create_table_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">CREATE TABLE</span> <span class="nt">table_name</span> <span class="kw">(</span> <span class="nt">column_def</span> { <span class="kw">,</span> <span class="nt">column_def</span> } <span class="kw">)</span><br>
<br>
<span class="nt">column_def</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="nt">column_name</span> <span class="nt">data_type</span> { <span class="nt">column_constraint</span> }<br>
<br>
<span class="nt">column_constraint</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">NOT NULL</span><br>
&ensp;&ensp;| <span class="kw">UNIQUE</span><br>
&ensp;&ensp;| <span class="kw">PRIMARY KEY</span><br>
&ensp;&ensp;| <span class="kw">DEFAULT</span> <span class="nt">expr</span><br>
&ensp;&ensp;| <span class="kw">CHECK</span> <span class="kw">(</span> <span class="nt">condition</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">REFERENCES</span> <span class="nt">table_name</span> <span class="kw">(</span> <span class="nt">column_name</span> <span class="kw">)</span>
    [ <span class="kw">ON DELETE CASCADE</span> ] [ <span class="kw">ON UPDATE CASCADE</span> ]<br>
</div>

<h3>ALTER TABLE</h3>

<div class="grammar">
<span class="nt">alter_table_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">ALTER TABLE</span> <span class="nt">table_name</span> <span class="kw">ADD COLUMN</span> <span class="nt">column_def</span><br>
&ensp;&ensp;| <span class="kw">ALTER TABLE</span> <span class="nt">table_name</span> <span class="kw">DROP COLUMN</span> <span class="nt">column_name</span><br>
&ensp;&ensp;| <span class="kw">ALTER TABLE</span> <span class="nt">table_name</span> <span class="kw">RENAME COLUMN</span> <span class="nt">old</span> <span class="kw">TO</span> <span class="nt">new</span><br>
&ensp;&ensp;| <span class="kw">ALTER TABLE</span> <span class="nt">table_name</span> <span class="kw">ALTER COLUMN</span> <span class="nt">column_name</span> <span class="kw">TYPE</span> <span class="nt">data_type</span><br>
</div>

<h3>Other DDL</h3>

<div class="grammar">
<span class="nt">drop_table_stmt</span> <span class="op">::=</span>
  <span class="kw">DROP TABLE</span> <span class="nt">table_name</span><br>
<br>
<span class="nt">create_index_stmt</span> <span class="op">::=</span>
  <span class="kw">CREATE INDEX</span> <span class="nt">name</span> <span class="kw">ON</span> <span class="nt">table_name</span> <span class="kw">(</span> <span class="nt">column_name</span> <span class="kw">)</span><br>
<br>
<span class="nt">drop_index_stmt</span> <span class="op">::=</span>
  <span class="kw">DROP INDEX</span> <span class="nt">name</span><br>
<br>
<span class="nt">create_type_stmt</span> <span class="op">::=</span>
  <span class="kw">CREATE TYPE</span> <span class="nt">name</span> <span class="kw">AS ENUM</span> <span class="kw">(</span> <span class="nt">string_literal</span> { <span class="kw">,</span> <span class="nt">string_literal</span> } <span class="kw">)</span><br>
<br>
<span class="nt">drop_type_stmt</span> <span class="op">::=</span>
  <span class="kw">DROP TYPE</span> <span class="nt">name</span><br>
<br>
<span class="nt">create_sequence_stmt</span> <span class="op">::=</span>
  <span class="kw">CREATE SEQUENCE</span> <span class="nt">name</span> [ <span class="kw">START WITH</span> <span class="nt">n</span> ] [ <span class="kw">INCREMENT BY</span> <span class="nt">n</span> ]<br>
<br>
<span class="nt">drop_sequence_stmt</span> <span class="op">::=</span>
  <span class="kw">DROP SEQUENCE</span> <span class="nt">name</span><br>
<br>
<span class="nt">create_view_stmt</span> <span class="op">::=</span>
  <span class="kw">CREATE VIEW</span> <span class="nt">name</span> <span class="kw">AS</span> <span class="nt">select_stmt</span><br>
<br>
<span class="nt">drop_view_stmt</span> <span class="op">::=</span>
  <span class="kw">DROP VIEW</span> <span class="nt">name</span><br>
<br>
<span class="nt">truncate_stmt</span> <span class="op">::=</span>
  <span class="kw">TRUNCATE</span> [ <span class="kw">TABLE</span> ] <span class="nt">table_name</span><br>
<br>
<span class="nt">create_foreign_table_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">CREATE FOREIGN TABLE</span> <span class="nt">table_name</span>
  <span class="kw">(</span> <span class="nt">column_def</span> { <span class="kw">,</span> <span class="nt">column_def</span> } <span class="kw">)</span>
  <span class="kw">OPTIONS</span> <span class="kw">(</span> <span class="kw">filename</span> <span class="nt">string_literal</span> <span class="kw">)</span>
 <br>
<br>
<span class="comment">-- Maps a Parquet file to a SQL table. Query with standard SQL.</span><br>
<span class="comment">-- Supported Parquet types: INT32, INT64, FLOAT, DOUBLE, BYTE_ARRAY (→ TEXT), INT96 (→ TIMESTAMP).</span><br>
<br>
<span class="nt">drop_foreign_table_stmt</span> <span class="op">::=</span>
  <span class="kw">DROP FOREIGN TABLE</span> <span class="nt">table_name</span><br>
</div>

<h3>COPY</h3>

<div class="grammar">
<span class="nt">copy_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">COPY</span> <span class="nt">table_name</span> <span class="kw">TO STDOUT</span> [ [ <span class="kw">WITH</span> ] <span class="kw">CSV</span> [ <span class="kw">HEADER</span> ] ]<br>
&ensp;&ensp;| <span class="kw">COPY</span> <span class="nt">table_name</span> <span class="kw">FROM STDIN</span> [ [ <span class="kw">WITH</span> ] <span class="kw">CSV</span> [ <span class="kw">HEADER</span> ] ]<br>
<br>
<span class="comment">-- COPY TO STDOUT: tab-delimited (default), CSV, CSV HEADER</span><br>
<span class="comment">-- COPY FROM STDIN: tab-delimited (default), CSV</span><br>
<span class="comment">-- NULL values represented as \N</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Data Types                                                 -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>8. Data Types</h2>

<div class="grammar">
<span class="nt">data_type</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">INT</span> | <span class="kw">INTEGER</span><br>
&ensp;&ensp;| <span class="kw">BIGINT</span><br>
&ensp;&ensp;| <span class="kw">FLOAT</span> | <span class="kw">DOUBLE PRECISION</span> | <span class="kw">REAL</span><br>
&ensp;&ensp;| <span class="kw">NUMERIC</span> | <span class="kw">DECIMAL</span><br>
&ensp;&ensp;| <span class="kw">TEXT</span><br>
&ensp;&ensp;| <span class="kw">VARCHAR</span> <span class="kw">(</span> <span class="nt">n</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">CHAR</span> <span class="kw">(</span> <span class="nt">n</span> <span class="kw">)</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="kw">BOOLEAN</span><br>
&ensp;&ensp;| <span class="kw">DATE</span><br>
&ensp;&ensp;| <span class="kw">TIME</span><br>
&ensp;&ensp;| <span class="kw">TIMESTAMP</span><br>
&ensp;&ensp;| <span class="kw">TIMESTAMPTZ</span><br>
&ensp;&ensp;| <span class="kw">INTERVAL</span><br>
&ensp;&ensp;| <span class="kw">UUID</span><br>
&ensp;&ensp;| <span class="kw">SERIAL</span><br>
&ensp;&ensp;| <span class="kw">BIGSERIAL</span><br>
&ensp;&ensp;| <span class="kw">SMALLINT</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="kw">BYTEA</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="kw">JSON</span> | <span class="kw">JSONB</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="kw">ARRAY</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="nt">enum_type_name</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Expressions                                                -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>9. Expressions</h2>

<div class="grammar">
<span class="nt">expr</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="nt">literal</span><br>
&ensp;&ensp;| <span class="nt">column_ref</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="nt">binary_op</span> <span class="nt">expr</span><br>
&ensp;&ensp;| <span class="nt">unary_op</span> <span class="nt">expr</span><br>
&ensp;&ensp;| <span class="nt">func_call</span><br>
&ensp;&ensp;| <span class="kw">CASE WHEN</span> <span class="nt">condition</span> <span class="kw">THEN</span> <span class="nt">expr</span> { <span class="kw">WHEN</span> ... } [ <span class="kw">ELSE</span> <span class="nt">expr</span> ] <span class="kw">END</span><br>
&ensp;&ensp;| <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span> <span class="comment">&ensp;-- scalar subquery</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">::</span> <span class="nt">data_type</span> <span class="comment">&ensp;-- postfix cast</span><br>
&ensp;&ensp;| <span class="kw">CAST</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">AS</span> <span class="nt">data_type</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">IS</span> [ <span class="kw">NOT</span> ] <span class="kw">NULL</span> <span class="comment">&ensp;-- postfix null test (expression-level)</span><br>
<br>
<span class="nt">binary_op</span> <span class="op">::=</span>
  <span class="kw">+</span> | <span class="kw">-</span> | <span class="kw">*</span> | <span class="kw">/</span> | <span class="kw">%</span> | <span class="kw">||</span><br>
<br>
<span class="nt">unary_op</span> <span class="op">::=</span>
  <span class="kw">-</span><br>
<br>
<span class="nt">literal</span> <span class="op">::=</span>
  <span class="nt">integer</span> | <span class="nt">float</span> | <span class="nt">string</span> | <span class="kw">TRUE</span> | <span class="kw">FALSE</span> | <span class="kw">NULL</span><br>
</div>

<h3>Built-in functions</h3>

<div class="grammar">
<span class="nt">func_call</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">COALESCE</span> <span class="kw">(</span> <span class="nt">expr</span> { <span class="kw">,</span> <span class="nt">expr</span> } <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">NULLIF</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">GREATEST</span> <span class="kw">(</span> <span class="nt">expr</span> { <span class="kw">,</span> <span class="nt">expr</span> } <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">LEAST</span> <span class="kw">(</span> <span class="nt">expr</span> { <span class="kw">,</span> <span class="nt">expr</span> } <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">UPPER</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">LOWER</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">LENGTH</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">TRIM</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">CONCAT</span> <span class="kw">(</span> <span class="nt">expr</span> { <span class="kw">,</span> <span class="nt">expr</span> } <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">SUBSTRING</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">FROM</span> <span class="nt">n</span> [ <span class="kw">FOR</span> <span class="nt">n</span> ] <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">NEXTVAL</span> <span class="kw">(</span> <span class="nt">string</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">CURRVAL</span> <span class="kw">(</span> <span class="nt">string</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">GEN_RANDOM_UUID</span> <span class="kw">()</span><br>
&ensp;&ensp;| <span class="kw">NOW</span> <span class="kw">()</span><br>
&ensp;&ensp;| <span class="kw">CURRENT_TIMESTAMP</span><br>
&ensp;&ensp;| <span class="kw">CURRENT_DATE</span><br>
&ensp;&ensp;| <span class="kw">EXTRACT</span> <span class="kw">(</span> <span class="nt">field</span> <span class="kw">FROM</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">DATE_PART</span> <span class="kw">(</span> <span class="nt">string</span> <span class="kw">,</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">DATE_TRUNC</span> <span class="kw">(</span> <span class="nt">string</span> <span class="kw">,</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">AGE</span> <span class="kw">(</span> <span class="nt">expr</span> [ <span class="kw">,</span> <span class="nt">expr</span> ] <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">TO_CHAR</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">string</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">REPLACE</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">LEFT</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">n</span> <span class="kw">)</span> / <span class="kw">RIGHT</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">n</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">LPAD</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">n</span> [ <span class="kw">,</span> <span class="nt">fill</span> ] <span class="kw">)</span> / <span class="kw">RPAD</span> <span class="kw">(</span> ... <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">CONCAT_WS</span> <span class="kw">(</span> <span class="nt">sep</span> <span class="kw">,</span> <span class="nt">expr</span> { <span class="kw">,</span> <span class="nt">expr</span> } <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">POSITION</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">IN</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">SPLIT_PART</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">delim</span> <span class="kw">,</span> <span class="nt">n</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">REPEAT</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">n</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">REVERSE</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">INITCAP</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">ABS</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">CEIL</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span> / <span class="kw">FLOOR</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">ROUND</span> <span class="kw">(</span> <span class="nt">expr</span> [ <span class="kw">,</span> <span class="nt">n</span> ] <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">POWER</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">expr</span> <span class="kw">)</span> / <span class="kw">SQRT</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">MOD</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">SIGN</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">RANDOM</span> <span class="kw">()</span><br>
&ensp;&ensp;| <span class="kw">STRING_AGG</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">,</span> <span class="nt">delimiter</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">ARRAY_AGG</span> <span class="kw">(</span> <span class="nt">expr</span> <span class="kw">)</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Conditions                                                 -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>10. Conditions (WHERE / ON / HAVING)</h2>

<div class="grammar">
<span class="nt">condition</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="nt">condition</span> <span class="kw">AND</span> <span class="nt">condition</span><br>
&ensp;&ensp;| <span class="nt">condition</span> <span class="kw">OR</span> <span class="nt">condition</span><br>
&ensp;&ensp;| <span class="kw">NOT</span> <span class="nt">condition</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="nt">cmp_op</span> <span class="nt">expr</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">BETWEEN</span> <span class="nt">expr</span> <span class="kw">AND</span> <span class="nt">expr</span><br>
&ensp;&ensp;| <span class="nt">expr</span> [ <span class="kw">NOT</span> ] <span class="kw">IN</span> <span class="kw">(</span> <span class="nt">value_list</span> | <span class="nt">select_stmt</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">(</span> <span class="nt">expr_list</span> <span class="kw">)</span> <span class="kw">IN</span> <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span> <span class="comment">&ensp;-- multi-column IN</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="nt">cmp_op</span> <span class="kw">ANY</span> <span class="kw">(</span> <span class="nt">value_list</span> | <span class="nt">select_stmt</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="nt">cmp_op</span> <span class="kw">ALL</span> <span class="kw">(</span> <span class="nt">value_list</span> | <span class="nt">select_stmt</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="nt">expr</span> [ <span class="kw">NOT</span> ] <span class="kw">LIKE</span> <span class="nt">pattern</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">ILIKE</span> <span class="nt">pattern</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">IS</span> [ <span class="kw">NOT</span> ] <span class="kw">NULL</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">IS</span> [ <span class="kw">NOT</span> ] <span class="kw">DISTINCT FROM</span> <span class="nt">expr</span><br>
&ensp;&ensp;| <span class="kw">EXISTS</span> <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="kw">NOT EXISTS</span> <span class="kw">(</span> <span class="nt">select_stmt</span> <span class="kw">)</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">SIMILAR TO</span> <span class="nt">pattern</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="nt">expr</span> <span class="kw">~</span> <span class="nt">pattern</span> <span class="comment">&ensp;-- POSIX regex</span> <span class="badge badge-no">(not yet supported)</span><br>
<br>
<span class="nt">cmp_op</span> <span class="op">::=</span>
  <span class="kw">=</span> | <span class="kw">!=</span> | <span class="kw">&lt;&gt;</span> | <span class="kw">&lt;</span> | <span class="kw">&gt;</span> | <span class="kw">&lt;=</span> | <span class="kw">&gt;=</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Transactions                                               -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>11. Transactions</h2>

<div class="grammar">
<span class="nt">transaction_stmt</span> <span class="op">::=</span><br>
&ensp;&ensp;  <span class="kw">BEGIN</span><br>
&ensp;&ensp;| <span class="kw">COMMIT</span><br>
&ensp;&ensp;| <span class="kw">ROLLBACK</span><br>
&ensp;&ensp;| <span class="kw">SAVEPOINT</span> <span class="nt">name</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="kw">RELEASE SAVEPOINT</span> <span class="nt">name</span> <span class="badge badge-no">(not yet supported)</span><br>
&ensp;&ensp;| <span class="kw">ROLLBACK TO SAVEPOINT</span> <span class="nt">name</span> <span class="badge badge-no">(not yet supported)</span><br>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Not Yet Supported                                          -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2>12. Not Yet Supported</h2>

<p>
    <strong>Types:</strong> <code>CHAR(n)</code>, <code>SMALLINT</code>, <code>BYTEA</code>,
    <code>JSON</code>/<code>JSONB</code>, <code>ARRAY</code>, composite types, range types.
    <strong>Expressions:</strong> <code>SIMILAR TO</code>, POSIX regex (<code>~</code>),
    <code>ARRAY[...]</code> constructor.
    <strong>DDL:</strong> <code>CREATE TABLE ... AS SELECT</code>,
    <code>CREATE MATERIALIZED VIEW</code>, table-level constraints,
    <code>CASCADE</code>/<code>RESTRICT</code> on DROP.
    <strong>Transactions:</strong> <code>SAVEPOINT</code>, isolation levels.
    <strong>Window:</strong> <code>RANGE BETWEEN</code>, <code>GROUPS BETWEEN</code>,
    named window definitions.
    <strong>Aggregation:</strong> <code>GROUPING SETS</code>,
    <code>FILTER (WHERE ...)</code>, ordered-set aggregates.
    <strong>Other:</strong> SQL-level <code>PREPARE</code>/<code>EXECUTE</code>
    (wire-level Extended Query Protocol is supported),
    <code>LISTEN</code>/<code>NOTIFY</code>,
    <code>GRANT</code>/<code>REVOKE</code>,
    stored procedures, triggers.
</p>

<footer class="site-footer">
    <a href="https://www.linkedin.com/in/martinskristiansen">Martin S. Kristiansen</a>
    &ensp;&middot;&ensp;
    <a href="https://github.com/martinsk/mskql">Source on GitHub</a>
    &ensp;&middot;&ensp;
    <a href="index.html">Documentation</a>
</footer>

</body>
</html>
