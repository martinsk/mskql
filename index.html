<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mskql</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400;1,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* ── Playground (embedded) ───────────────────────────── */
        .playground-controls {
            display: flex;
            gap: 0.6rem;
            align-items: center;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }
        .playground-controls select {
            font-family: 'EB Garamond', Georgia, serif;
            font-size: 0.95rem;
            padding: 0.3rem 0.5rem;
            border: 1px solid var(--rule);
            background: var(--bg);
            color: var(--fg);
            border-radius: 3px;
        }
        .playground-controls button {
            font-family: 'EB Garamond', Georgia, serif;
            font-size: 0.95rem;
            padding: 0.3rem 1rem;
            border: 1px solid var(--rule);
            background: var(--bg);
            color: var(--fg);
            border-radius: 3px;
            cursor: pointer;
        }
        .playground-controls button:hover { border-color: var(--accent); color: var(--accent); }
        .run-btn { background: var(--accent) !important; color: #fff !important; border-color: var(--accent) !important; font-weight: 600; }
        .run-btn:hover { background: #800 !important; }
        .run-btn:disabled { opacity: 0.5; cursor: default; }

        .editor-wrap {
            position: relative;
            min-height: 160px;
            border: 1px solid var(--rule);
            border-left: 3px solid var(--accent);
            background: var(--code-bg);
            border-radius: 0;
        }
        .editor-wrap pre {
            margin: 0;
            padding: 1rem 1.2rem;
            border: none;
            background: transparent;
            font-family: 'Menlo', 'Consolas', 'DejaVu Sans Mono', monospace;
            font-size: 0.82rem;
            line-height: 1.55;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow: hidden;
            pointer-events: none;
        }
        .editor-wrap pre code {
            font-family: inherit;
            font-size: inherit;
            background: none;
            padding: 0;
            border-radius: 0;
        }
        .editor-wrap pre code.hljs {
            background: transparent;
            padding: 0;
        }
        #sql-input {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            font-family: 'Menlo', 'Consolas', 'DejaVu Sans Mono', monospace;
            font-size: 0.82rem;
            line-height: 1.55;
            padding: 1rem 1.2rem;
            border: none;
            background: transparent;
            color: transparent;
            caret-color: var(--fg);
            resize: none;
            tab-size: 4;
            outline: none;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow: auto;
        }
        #sql-input::selection {
            background: rgba(160, 0, 0, 0.2);
            color: transparent;
        }

        .pg-status {
            font-size: 0.85rem;
            color: var(--fg-dim);
            margin-top: 0.4rem;
            margin-bottom: 1rem;
            min-height: 1.2em;
        }
        .pg-status.error { color: var(--accent); }

        .pg-result-wrap {
            overflow-x: auto;
            margin-top: 0.5rem;
        }
        .pg-result-table {
            border-collapse: collapse;
            font-size: 0.85rem;
            width: 100%;
            font-family: 'Menlo', 'Consolas', 'DejaVu Sans Mono', monospace;
        }
        .pg-result-table th {
            text-align: left;
            font-weight: 600;
            padding: 0.4rem 0.8rem;
            border-bottom: 2px solid var(--fg);
            white-space: nowrap;
            font-family: 'EB Garamond', Georgia, serif;
            font-size: 0.95rem;
        }
        .pg-result-table td {
            padding: 0.3rem 0.8rem;
            border-bottom: 1px solid var(--rule);
            white-space: pre;
        }
        .pg-result-table tr:last-child td { border-bottom: 2px solid var(--fg); }
        .pg-result-table .null-cell { color: var(--fg-dim); font-style: italic; }

        .pg-result-message {
            font-size: 0.95rem;
            color: var(--fg-dim);
            padding: 0.8rem 0;
            font-style: italic;
        }
        .pg-result-message.error-msg {
            color: var(--accent);
            font-style: normal;
            font-family: 'Menlo', 'Consolas', monospace;
            font-size: 0.82rem;
        }

        /* ── CTA cards ───────────────────────────────────────── */
        .cta-row {
            display: flex;
            gap: 1.2rem;
            margin: 2rem 0;
        }
        .cta-card {
            flex: 1;
            border: 1px solid var(--rule);
            padding: 1.2rem 1.4rem;
            border-radius: 4px;
            background: #fff;
        }
        .cta-card h3 {
            margin-top: 0;
            margin-bottom: 0.4rem;
        }
        .cta-card p {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }
        .cta-card a.cta-link {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--accent);
            background-image: none;
        }
        @media (max-width: 700px) {
            .cta-row { flex-direction: column; }
            .ai-split { flex-direction: column; }
        }

        /* ── Benchmark summary ───────────────────────────────── */
        .bench-faster { color: #1a7a1a; font-weight: 600; }
        .bench-slower { color: var(--accent); font-weight: 600; }

        .summary-chart {
            margin: 1.2rem 0 1.5rem 0;
        }
        .summary-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .summary-name {
            width: 170px;
            font-size: 0.85rem;
            text-align: right;
            padding-right: 10px;
            flex-shrink: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .summary-bars {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .summary-bar-row {
            display: flex;
            align-items: center;
            gap: 4px;
            height: 13px;
        }
        .summary-bar-label {
            font-size: 0.6rem;
            font-family: 'Menlo', 'Consolas', monospace;
            width: 32px;
            text-align: right;
            flex-shrink: 0;
            color: var(--fg-dim);
        }
        .summary-bar {
            height: 11px;
            border-radius: 2px;
            min-width: 2px;
        }
        .summary-bar-val {
            font-size: 0.65rem;
            font-family: 'Menlo', 'Consolas', monospace;
            color: var(--fg-dim);
            margin-left: 4px;
            white-space: nowrap;
        }
        .bar-mskql { background: var(--accent); }
        .bar-pg { background: #4a7ab5; }
        .bar-duck { background: #e8a735; }
        .legend {
            display: flex;
            gap: 1.2rem;
            margin-bottom: 0.6rem;
            font-size: 0.78rem;
            color: var(--fg-dim);
        }
        .legend-swatch {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 2px;
            vertical-align: middle;
            margin-right: 4px;
        }
    </style>
</head>
<body>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  WHAT: Title block                                          -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h1>mskql</h1>
<span class="subtitle">An in-memory SQL engine written in C&mdash;faster than PostgreSQL and DuckDB on 37 of 84 benchmarks, built entirely by&nbsp;AI</span>
<p class="byline">
    <a href="https://www.linkedin.com/in/martinskristiansen" class="author-name"><strong>Martin S. Kristiansen</strong></a>
    &ensp;&middot;&ensp;
    <a href="https://github.com/martinsk/mskql">github.com/martinsk/mskql</a>
    &ensp;&middot;&ensp;
    <a href="tutorials/index.html">Tutorials</a>
</p>
<hr class="title-rule">

<p>
    This project distills the core ideas of a database engine&mdash;wire protocol, parser,
    query executor, storage&mdash;into ~39,000 lines of C with zero external
    dependencies. One <code>.c</code> file per subsystem. Three AI agents built it
    in iterative rounds: no human wrote any C code or SQL test. 1,240+ test cases,
    every one memory-checked. Query Parquet files with standard SQL.
    Connect with <code>psql</code> on port&nbsp;5433
    or <a href="#try-it">try it in the browser</a> via WebAssembly.
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Navigation strip                                           -->
<!-- ═══════════════════════════════════════════════════════════ -->

<nav class="toc-strip">
<a href="#wire-compat">Wire protocol</a>
<a href="#performance">Performance</a>
<a href="#parquet">Parquet</a>
<a href="#ai-built">AI-built</a>
<a href="#try-it">Playground</a>
<span class="toc-sep"></span>
<a href="getting-started.html">Getting Started</a>
<a href="architecture.html">Architecture</a>
<a href="sql-reference.html">SQL Reference</a>
<a href="bench-vs-pg.html">Benchmarks</a>
<a href="testing.html">Testing</a>
<a href="grammar.html">Grammar</a>
<a href="tutorials/index.html">Tutorials</a>
</nav>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  SO WHAT: Three proof points                                -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2 id="wire-compat">PostgreSQL wire-protocol compatible</h2>

<p>
    The server implements PostgreSQL wire protocol&nbsp;v3: Simple Query,
    Extended Query (prepared statements, <code>$1</code>/<code>$2</code> parameters),
    and COPY. Connect with <code>psql</code>, pgAdmin, DBeaver, or any language driver.
    Default port&nbsp;5433.
</p>

<pre><code class="language-bash">make && ./build/mskql                         # build & start
psql -h 127.0.0.1 -p 5433 -U test -d mskql   # connect</code></pre>

<h2 id="performance">Performance: mskql vs PostgreSQL vs DuckDB</h2>

<p>
    84 batch workloads and 15 concurrent throughput workloads, measured on the same
    machine. On all 28 cached batch workloads and 13 of 15 throughput tests,
    mskql is faster than PostgreSQL. Against DuckDB, mskql wins 37 of 84 workloads&mdash;aggregates
    6&times;, expression aggregates 7&times;, joins, CTEs, subqueries.
    DuckDB wins full scans (4.4&times;) and sorts (4.8&times;).
</p>

<h3>Batch latency <span style="font-weight:400; font-size:0.85em; color:var(--fg-dim)">&mdash; shorter bars = faster</span></h3>

<div class="summary-chart">
    <div class="legend">
        <span><span class="legend-swatch" style="background:var(--accent)"></span>mskql</span>
        <span><span class="legend-swatch" style="background:#4a7ab5"></span>PostgreSQL</span>
        <span><span class="legend-swatch" style="background:#e8a735"></span>DuckDB</span>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Correlated subquery</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:2%"></div><span class="summary-bar-val">24ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:100%"></div><span class="summary-bar-val">3,498ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:3%"></div><span class="summary-bar-val">38ms</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Expression aggregate</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:11%"></div><span class="summary-bar-val">35ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:100%"></div><span class="summary-bar-val">331ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:72%"></div><span class="summary-bar-val">239ms</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Group + sum</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:12%"></div><span class="summary-bar-val">35ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:100%"></div><span class="summary-bar-val">290ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:73%"></div><span class="summary-bar-val">212ms</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Bulk insert</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:13%"></div><span class="summary-bar-val">291ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:40%"></div><span class="summary-bar-val">881ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:100%"></div><span class="summary-bar-val">2,204ms</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Analytical CTE</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:28%"></div><span class="summary-bar-val">22ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:100%"></div><span class="summary-bar-val">78ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:45%"></div><span class="summary-bar-val">35ms</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Parquet aggregate</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:37%"></div><span class="summary-bar-val">28ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:100%"></div><span class="summary-bar-val">76ms</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Full table scan</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:67%"></div><span class="summary-bar-val">306ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:100%"></div><span class="summary-bar-val">460ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:15%"></div><span class="summary-bar-val">69ms</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Large sort</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:67%"></div><span class="summary-bar-val">246ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:100%"></div><span class="summary-bar-val">365ms</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">Duck</span><div class="summary-bar bar-duck" style="width:14%"></div><span class="summary-bar-val">51ms</span></div>
        </div>
    </div>
</div>

<h3>Concurrent throughput <span style="font-weight:400; font-size:0.85em; color:var(--fg-dim)">&mdash; longer bars = more queries/sec (mskql vs PG only)</span></h3>

<div class="summary-chart">
    <div class="legend">
        <span><span class="legend-swatch" style="background:var(--accent)"></span>mskql</span>
        <span><span class="legend-swatch" style="background:#4a7ab5"></span>PostgreSQL</span>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Mixed analytical</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:100%"></div><span class="summary-bar-val">94,729 QPS</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:1%"></div><span class="summary-bar-val">689 QPS</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Multi-join</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:100%"></div><span class="summary-bar-val">36,273 QPS</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:1%"></div><span class="summary-bar-val">462 QPS</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Group + sum</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:100%"></div><span class="summary-bar-val">95,044 QPS</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:15%"></div><span class="summary-bar-val">13,929 QPS</span></div>
        </div>
    </div>
    <div class="summary-row">
        <div class="summary-name"><strong>Indexed point lookup</strong></div>
        <div class="summary-bars">
            <div class="summary-bar-row"><span class="summary-bar-label">mskql</span><div class="summary-bar bar-mskql" style="width:100%"></div><span class="summary-bar-val">78,600 QPS</span></div>
            <div class="summary-bar-row"><span class="summary-bar-label">PG</span><div class="summary-bar bar-pg" style="width:30%"></div><span class="summary-bar-val">23,461 QPS</span></div>
        </div>
    </div>
</div>

<p>
    &#8594;&ensp;<a href="bench-vs-pg.html"><strong>All 84 batch + 15 throughput results</strong></a>
    &ensp;&middot;&ensp;
    <a href="dev/bench/index.html"><strong>Historical charts</strong></a>
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Parquet foreign tables                                     -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2 id="parquet">Query Parquet files with standard SQL</h2>

<p>
    <code>CREATE FOREIGN TABLE</code> maps a Parquet file to a SQL table.
    No ETL, no data loading&mdash;query directly with joins, aggregates, and subqueries.
    The same result cache that accelerates in-memory queries applies to Parquet scans.
</p>

<pre><code class="language-sql">CREATE FOREIGN TABLE events
    OPTIONS (filename '/data/events.parquet');

SELECT event_type, COUNT(*), SUM(amount)
FROM events
GROUP BY event_type;</code></pre>

<p>
    9 Parquet workloads (50K&ndash;200K rows). On cached queries, mskql is faster than DuckDB on
    8 of 9: aggregates 28ms vs 76ms (2.7&times;), subqueries
    21ms vs 44ms (2&times;), joins 28ms vs 35ms. DuckDB wins cold full scans:
    32ms vs 449ms (14&times;).
</p>

<p>
    &#8594;&ensp;<a href="bench-vs-pg.html#parquet"><strong>All 9 Parquet benchmark results</strong></a>
</p>

<h2 id="ai-built">Built entirely by AI agents</h2>

<div class="ai-split" style="display:flex; gap:2rem; align-items:flex-start; margin:1rem 0 1.4rem 0;">
<div style="flex:1 1 50%; min-width:0;">
<p style="margin-bottom:0.8rem;">
    Three agents in iterative rounds. <strong>Challenger</strong> writes adversarial
    SQL tests. <strong>Reviewer</strong> flags code-quality issues.
    <strong>Writer</strong> fixes until all 1,240+ tests pass.
    No human wrote any C code or SQL test cases.
</p>
<p style="margin-bottom:0;">
    &#8594;&ensp;<a href="construction.html"><strong>Read more about the process</strong></a>
</p>
</div>
<div style="flex:1 1 50%; min-width:0;">
<svg viewBox="0 0 340 110" xmlns="http://www.w3.org/2000/svg" font-family="'EB Garamond', Georgia, serif" style="width:100%; height:auto;">
  <rect width="340" height="110" fill="#fffff8"/>
  <defs>
    <marker id="ah" markerWidth="6" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <path d="M0,0 L6,2.5 L0,5" fill="#a00"/>
    </marker>
  </defs>
  <rect x="8" y="8" width="88" height="44" rx="4" fill="#fff" stroke="#111" stroke-width="1.2"/>
  <text x="52" y="26" text-anchor="middle" font-size="11" font-weight="600" fill="#111">Challenger</text>
  <text x="52" y="42" text-anchor="middle" font-size="8.5" fill="#555">adversarial tests</text>
  <rect x="126" y="8" width="88" height="44" rx="4" fill="#fff" stroke="#111" stroke-width="1.2"/>
  <text x="170" y="26" text-anchor="middle" font-size="11" font-weight="600" fill="#111">Writer</text>
  <text x="170" y="42" text-anchor="middle" font-size="8.5" fill="#555">writes &amp; fixes</text>
  <rect x="244" y="8" width="88" height="44" rx="4" fill="#fff" stroke="#111" stroke-width="1.2"/>
  <text x="288" y="26" text-anchor="middle" font-size="11" font-weight="600" fill="#111">Reviewer</text>
  <text x="288" y="42" text-anchor="middle" font-size="8.5" fill="#555">code review</text>
  <path d="M96,22 L126,22" stroke="#a00" stroke-width="1.2" fill="none" marker-end="url(#ah)"/>
  <path d="M126,40 L96,40" stroke="#a00" stroke-width="1.2" fill="none" marker-end="url(#ah)"/>
  <path d="M214,22 L244,22" stroke="#a00" stroke-width="1.2" fill="none" marker-end="url(#ah)"/>
  <path d="M244,40 L214,40" stroke="#a00" stroke-width="1.2" fill="none" marker-end="url(#ah)"/>
  <path d="M288,52 C288,72 170,78 52,72 C30,71 18,66 18,52"
        stroke="#ccc" stroke-width="1" fill="none" stroke-dasharray="3,2"/>
  <text x="170" y="90" text-anchor="middle" font-size="8.5" fill="#555" font-style="italic">iterate until all 1,240+ tests pass</text>
</svg>
</div>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  NOW WHAT: Embedded playground                              -->
<!-- ═══════════════════════════════════════════════════════════ -->

<h2 id="try-it">Try it &mdash; right here</h2>

<p>
    A fully functional mskql database running <strong>entirely in your browser</strong>
    via WebAssembly&mdash;no server, no network requests. Choose an example or write
    your own SQL.
</p>

<div class="playground-controls">
    <select id="examples" aria-label="Example queries">
        <option value="">— Choose an example —</option>
        <option value="basics">Create, Insert &amp; Select</option>
        <option value="joins">Joins</option>
        <option value="aggregation">Aggregation &amp; GROUP BY</option>
        <option value="window">Window Functions</option>
        <option value="generate_series">generate_series()</option>
        <option value="cte">Common Table Expressions</option>
        <option value="upsert">Upsert (ON CONFLICT)</option>
        <option value="datetime">Date/Time Arithmetic</option>
    </select>
    <button class="run-btn" id="run-btn" disabled>&#9654; Run</button>
    <button id="reset-btn" disabled>Reset DB</button>
</div>

<div class="editor-wrap">
    <pre><code id="sql-highlight" class="language-sql"></code></pre>
    <textarea id="sql-input" spellcheck="false" placeholder="Enter SQL here...">CREATE TABLE users (
    id INT PRIMARY KEY,
    name TEXT NOT NULL,
    email TEXT,
    age INT
);

INSERT INTO users VALUES
    (1, 'Alice',   'alice@example.com',   32),
    (2, 'Bob',     'bob@example.com',     28),
    (3, 'Charlie', 'charlie@example.com', 35),
    (4, 'Diana',   'diana@example.com',   29);

SELECT * FROM users WHERE age > 30 ORDER BY name;</textarea>
</div>

<div class="pg-status" id="pg-status">Loading WebAssembly&hellip;</div>

<div id="pg-result">
    <div class="pg-result-message">Run a query to see results here.</div>
</div>

<p style="font-size:0.9rem; color:var(--fg-dim); margin-top:0.5rem;">
    &#8594;&ensp;<a href="playground.html"><strong>Open full playground</strong></a>
    &ensp;(more space, more examples)
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  CTA cards                                                  -->
<!-- ═══════════════════════════════════════════════════════════ -->

<div class="cta-row">
    <div class="cta-card">
        <h3>Build &amp; connect</h3>
        <p>Ten queries from <code>CREATE TABLE</code> to recursive CTEs, all through <code>psql</code>.</p>
        <a href="getting-started.html" class="cta-link">Getting started &rarr;</a>
    </div>
    <div class="cta-card">
        <h3>Read the source</h3>
        <p>~39,000 lines of C11. Every subsystem in a single file.</p>
        <a href="https://github.com/martinsk/mskql" class="cta-link">GitHub &rarr;</a>
    </div>
</div>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Below the fold: compact reference                          -->
<!-- ═══════════════════════════════════════════════════════════ -->

<hr>

<h2 id="reference">Reference</h2>

<p>
    <a href="architecture.html"><strong>Architecture</strong></a>&ensp;&mdash;&ensp;wire
    protocol, parser, vectorized executor, storage. One <code>.c</code> file per subsystem.
    <br>
    <a href="sql-reference.html"><strong>SQL reference</strong></a>&ensp;&mdash;&ensp;DDL,
    DML, joins, aggregation, window functions, CTEs, subqueries, 30+ built-in functions.
    &ensp;<a href="grammar.html">Grammar</a>
    <br>
    <a href="testing.html"><strong>Testing</strong></a>&ensp;&mdash;&ensp;1,240+ test cases,
    every one under a memory-safety checker. Parallel execution across all cores.
    <br>
    <a href="bench-vs-pg.html"><strong>Benchmarks</strong></a>&ensp;&mdash;&ensp;mskql
    vs PostgreSQL and DuckDB on 84 batch workloads and 15 throughput workloads.
    &ensp;<a href="dev/bench/index.html">Historical charts</a>
</p>

<!-- ═══════════════════════════════════════════════════════════ -->
<!--  Footer                                                     -->
<!-- ═══════════════════════════════════════════════════════════ -->

<footer class="site-footer">
    <a href="https://www.linkedin.com/in/martinskristiansen">Martin S. Kristiansen</a>
    &ensp;&middot;&ensp;
    <a href="https://github.com/martinsk/mskql">Source on GitHub</a>
    &ensp;&middot;&ensp;
    <a href="getting-started.html">Getting Started</a>
    &ensp;&middot;&ensp;
    <a href="architecture.html">Architecture</a>
    &ensp;&middot;&ensp;
    <a href="sql-reference.html">SQL Reference</a>
    &ensp;&middot;&ensp;
    <a href="testing.html">Testing</a>
    &ensp;&middot;&ensp;
    <a href="bench-vs-pg.html">Benchmarks</a>
    &ensp;&middot;&ensp;
    <a href="grammar.html">Grammar</a>
    &ensp;&middot;&ensp;
    <a href="tutorials/index.html">Tutorials</a>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script src="wasm/mskql-wasm.js"></script>
<script>
(function() {
    const db = new MskqlDB();
    const sqlInput   = document.getElementById('sql-input');
    const runBtn     = document.getElementById('run-btn');
    const resetBtn   = document.getElementById('reset-btn');
    const statusEl   = document.getElementById('pg-status');
    const resultEl   = document.getElementById('pg-result');
    const examplesEl = document.getElementById('examples');
    const highlightEl = document.getElementById('sql-highlight');

    function syncHighlight() {
        highlightEl.textContent = sqlInput.value + '\n';
        delete highlightEl.dataset.highlighted;
        hljs.highlightElement(highlightEl);
    }
    sqlInput.addEventListener('input', syncHighlight);
    sqlInput.addEventListener('scroll', function() {
        highlightEl.parentElement.scrollTop = sqlInput.scrollTop;
        highlightEl.parentElement.scrollLeft = sqlInput.scrollLeft;
    });

    var examples = {
        basics: "CREATE TABLE users (\n    id INT PRIMARY KEY,\n    name TEXT NOT NULL,\n    email TEXT,\n    age INT\n);\n\nINSERT INTO users VALUES\n    (1, 'Alice',   'alice@example.com',   32),\n    (2, 'Bob',     'bob@example.com',     28),\n    (3, 'Charlie', 'charlie@example.com', 35),\n    (4, 'Diana',   'diana@example.com',   29);\n\nSELECT * FROM users WHERE age > 30 ORDER BY name;",

        joins: "CREATE TABLE departments (id INT PRIMARY KEY, name TEXT);\nINSERT INTO departments VALUES (1, 'Engineering'), (2, 'Marketing'), (3, 'Sales');\n\nCREATE TABLE employees (id INT PRIMARY KEY, name TEXT, dept_id INT, salary INT);\nINSERT INTO employees VALUES\n    (1, 'Alice', 1, 95000), (2, 'Bob', 1, 88000),\n    (3, 'Charlie', 2, 72000), (4, 'Diana', 3, 81000),\n    (5, 'Eve', 2, 69000);\n\nSELECT e.name, d.name AS department, e.salary\nFROM employees e\nJOIN departments d ON e.dept_id = d.id\nORDER BY e.salary DESC;",

        aggregation: "CREATE TABLE sales (\n    id INT PRIMARY KEY,\n    product TEXT,\n    region TEXT,\n    amount NUMERIC\n);\n\nINSERT INTO sales VALUES\n    (1, 'Widget', 'North', 150.00),\n    (2, 'Widget', 'South', 200.00),\n    (3, 'Gadget', 'North', 300.00),\n    (4, 'Gadget', 'South', 250.00),\n    (5, 'Widget', 'North', 175.00),\n    (6, 'Gadget', 'North', 325.00);\n\nSELECT product, region,\n       COUNT(*) AS num_sales,\n       SUM(amount) AS total,\n       AVG(amount) AS avg_sale\nFROM sales\nGROUP BY product, region\nORDER BY product, region;",

        window: "CREATE TABLE scores (\n    student TEXT,\n    subject TEXT,\n    score INT\n);\n\nINSERT INTO scores VALUES\n    ('Alice', 'Math', 92), ('Alice', 'English', 88),\n    ('Bob', 'Math', 85), ('Bob', 'English', 91),\n    ('Charlie', 'Math', 96), ('Charlie', 'English', 79),\n    ('Diana', 'Math', 88), ('Diana', 'English', 94);\n\nSELECT student, subject, score,\n       RANK() OVER (PARTITION BY subject ORDER BY score DESC) AS rank,\n       AVG(score) OVER (PARTITION BY subject) AS subject_avg\nFROM scores\nORDER BY subject, rank;",

        generate_series: "SELECT n, n * n AS square\nFROM generate_series(1, 10) AS g(n);",

        cte: "CREATE TABLE tree (id INT PRIMARY KEY, parent_id INT, name TEXT);\nINSERT INTO tree VALUES\n    (1, NULL, 'Root'),\n    (2, 1, 'Child A'), (3, 1, 'Child B'),\n    (4, 2, 'Grandchild A1'), (5, 2, 'Grandchild A2'),\n    (6, 3, 'Grandchild B1');\n\nWITH RECURSIVE descendants AS (\n    SELECT id, name, 0 AS depth FROM tree WHERE parent_id IS NULL\n    UNION ALL\n    SELECT t.id, t.name, d.depth + 1\n    FROM tree t JOIN descendants d ON t.parent_id = d.id\n)\nSELECT depth, name FROM descendants ORDER BY depth, name;",

        upsert: "CREATE TABLE kv (key TEXT PRIMARY KEY, value INT);\n\nINSERT INTO kv VALUES ('a', 1), ('b', 2), ('c', 3);\n\nINSERT INTO kv VALUES ('b', 20), ('d', 4)\nON CONFLICT (key) DO UPDATE SET value = EXCLUDED.value;\n\nSELECT * FROM kv ORDER BY key;",

        datetime: "SELECT\n    '2024-01-15'::date + 30 AS plus_30_days,\n    '2024-06-15 10:30:00'::timestamp - '2024-01-01 00:00:00'::timestamp AS diff,\n    EXTRACT(MONTH FROM '2024-03-15'::date) AS month,\n    DATE_TRUNC('month', '2024-03-15'::date) AS trunc_month;"
    };

    examplesEl.addEventListener('change', function() {
        if (this.value && examples[this.value]) {
            sqlInput.value = examples[this.value];
            syncHighlight();
            this.selectedIndex = 0;
        }
    });

    function runQuery() {
        var sql = sqlInput.value.trim();
        if (!sql) return;

        statusEl.className = 'pg-status';
        statusEl.textContent = 'Running\u2026';

        setTimeout(function() {
            var t0 = performance.now();
            var res = db.exec(sql);
            var elapsed = (performance.now() - t0).toFixed(1);

            if (!res.ok) {
                statusEl.className = 'pg-status error';
                statusEl.textContent = 'Error (' + elapsed + ' ms)';
                resultEl.innerHTML = '<div class="pg-result-message error-msg">' +
                    escapeHtml(res.output) + '</div>';
                return;
            }

            var output = res.output.trim();
            if (output === 'OK' || output === '') {
                statusEl.className = 'pg-status';
                statusEl.textContent = 'OK (' + elapsed + ' ms)';
                resultEl.innerHTML = '<div class="pg-result-message">Statement executed successfully.</div>';
                return;
            }

            var lines = output.split('\n').filter(function(l) { return l.length > 0; });
            if (lines.length === 0) {
                statusEl.className = 'pg-status';
                statusEl.textContent = '0 rows (' + elapsed + ' ms)';
                resultEl.innerHTML = '<div class="pg-result-message">Query returned no rows.</div>';
                return;
            }

            var headers = lines[0].split('\t');
            var dataLines = lines.slice(1);

            statusEl.className = 'pg-status';
            statusEl.textContent = dataLines.length + ' row' + (dataLines.length !== 1 ? 's' : '') + ' (' + elapsed + ' ms)';

            var html = '<div class="pg-result-wrap"><table class="pg-result-table">';
            html += '<thead><tr>';
            for (var j = 0; j < headers.length; j++) {
                html += '<th>' + escapeHtml(headers[j]) + '</th>';
            }
            html += '</tr></thead><tbody>';
            for (var i = 0; i < dataLines.length; i++) {
                var cells = dataLines[i].split('\t');
                html += '<tr>';
                for (var j2 = 0; j2 < cells.length; j2++) {
                    var val = cells[j2];
                    if (val === 'NULL') {
                        html += '<td class="null-cell">NULL</td>';
                    } else {
                        html += '<td>' + escapeHtml(val) + '</td>';
                    }
                }
                html += '</tr>';
            }
            html += '</tbody></table></div>';
            resultEl.innerHTML = html;
        }, 10);
    }

    function escapeHtml(s) {
        return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    }

    runBtn.addEventListener('click', runQuery);

    sqlInput.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
            e.preventDefault();
            runQuery();
        }
        if (e.key === 'Tab') {
            e.preventDefault();
            var start = this.selectionStart;
            var end = this.selectionEnd;
            this.value = this.value.substring(0, start) + '    ' + this.value.substring(end);
            this.selectionStart = this.selectionEnd = start + 4;
        }
    });

    resetBtn.addEventListener('click', function() {
        db.reset();
        statusEl.className = 'pg-status';
        statusEl.textContent = 'Database reset.';
        resultEl.innerHTML = '<div class="pg-result-message">Database has been reset. All tables dropped.</div>';
    });

    syncHighlight();

    db.init('wasm/mskql.wasm').then(function() {
        statusEl.textContent = 'Database ready. Press Run or Ctrl+Enter.';
        runBtn.disabled = false;
        resetBtn.disabled = false;
    }).catch(function(err) {
        statusEl.className = 'pg-status error';
        statusEl.textContent = 'Failed to load: ' + err.message;
        console.error(err);
    });

    hljs.highlightAll();
})();
</script>

</body>
</html>
